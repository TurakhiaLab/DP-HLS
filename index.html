
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
      
      
      <link rel="icon" href="images/dp_hls_logo.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.5.49">
    
    
      
        <title>DP-HLS</title>
      
    
    
      <link rel="stylesheet" href="assets/stylesheets/main.6f8fc17f.min.css">
      
        
        <link rel="stylesheet" href="assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="stylesheets/extra.css">
    
    <script>__md_scope=new URL(".",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="custom" data-md-color-accent="white">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#dp-hls-a-high-level-synthesis-framework-for-accelerating-dynamic-programming-algorithms-in-bioinformatics" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow md-header--lifted" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="index.html" title="DP-HLS" class="md-header__button md-logo" aria-label="DP-HLS" data-md-component="logo">
      
  <img src="images/dp_hls_logo.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            DP-HLS
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Home
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="custom" data-md-color-accent="white"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="slate" data-md-color-primary="white" data-md-color-accent="white"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12s-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/TurakhiaLab/DP-HLS" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.7.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"/></svg>
  </div>
  <div class="md-source__repository">
    TurakhiaLab/DP-HLS
  </div>
</a>
      </div>
    
  </nav>
  
    
      
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
    
  
  
    <li class="md-tabs__item md-tabs__item--active">
      <a href="index.html" class="md-tabs__link">
        
  
    
  
  Home

      </a>
    </li>
  

      
    </ul>
  </div>
</nav>
    
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


  

<nav class="md-nav md-nav--primary md-nav--lifted md-nav--integrated" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="index.html" title="DP-HLS" class="md-nav__button md-logo" aria-label="DP-HLS" data-md-component="logo">
      
  <img src="images/dp_hls_logo.png" alt="logo">

    </a>
    DP-HLS
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/TurakhiaLab/DP-HLS" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.7.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"/></svg>
  </div>
  <div class="md-source__repository">
    TurakhiaLab/DP-HLS
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    Home
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="index.html" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    Home
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#dp-hls-video-tutorial" class="md-nav__link">
    <span class="md-ellipsis">
      DP-HLS Video Tutorial
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#introduction" class="md-nav__link">
    <span class="md-ellipsis">
      Introduction
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Introduction">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#2-d-dynamic-programming-paradigm" class="md-nav__link">
    <span class="md-ellipsis">
      2-D Dynamic Programming Paradigm
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#variations-in-2-d-dynamic-programming-algorithms" class="md-nav__link">
    <span class="md-ellipsis">
      Variations in 2-D Dynamic Programming algorithms
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dp-hls-framework" class="md-nav__link">
    <span class="md-ellipsis">
      DP-HLS Framework
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#features" class="md-nav__link">
    <span class="md-ellipsis">
      Features
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#demo-video" class="md-nav__link">
    <span class="md-ellipsis">
      Demo Video
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#quick-start" class="md-nav__link">
    <span class="md-ellipsis">
      Quick Start
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Quick Start">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#step-0-create-aws-instances" class="md-nav__link">
    <span class="md-ellipsis">
      Step 0: Create AWS instances
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#step-1-clone-the-dp-hls-repository-from-github" class="md-nav__link">
    <span class="md-ellipsis">
      Step 1: Clone the DP-HLS repository from GitHub
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#step-2-install-the-required-dependencies" class="md-nav__link">
    <span class="md-ellipsis">
      Step 2: Install the required dependencies
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#step-3-build-and-simulate-the-kernel" class="md-nav__link">
    <span class="md-ellipsis">
      Step 3: Build and simulate the kernel
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#step-4-synthesize-the-kernel" class="md-nav__link">
    <span class="md-ellipsis">
      Step 4: Synthesize the kernel
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#step-5-deploy-the-kernel-on-fpga" class="md-nav__link">
    <span class="md-ellipsis">
      Step 5: Deploy the kernel on FPGA
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#customize-new-kernels" class="md-nav__link">
    <span class="md-ellipsis">
      Customize new kernels
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Customize new kernels">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#step-1-understanding-variations-in-2-d-dynamic-programming-paradigm" class="md-nav__link">
    <span class="md-ellipsis">
      Step 1: Understanding variations in 2-D Dynamic Programming paradigm
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Step 1: Understanding variations in 2-D Dynamic Programming paradigm">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#variations-in-initialization-step" class="md-nav__link">
    <span class="md-ellipsis">
      Variations in Initialization Step
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#variations-in-traceback-step" class="md-nav__link">
    <span class="md-ellipsis">
      Variations in Traceback Step
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#variations-in-scoring-logic" class="md-nav__link">
    <span class="md-ellipsis">
      Variations in Scoring Logic
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#variations-in-input-alphabets" class="md-nav__link">
    <span class="md-ellipsis">
      Variations in Input Alphabets
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#step-2-customize-data-types-and-parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Step 2: Customize data types and parameters
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Step 2: Customize data types and parameters">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-modify-sequence-alphabet" class="md-nav__link">
    <span class="md-ellipsis">
      1. Modify Sequence Alphabet
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-modify-scoring-layers" class="md-nav__link">
    <span class="md-ellipsis">
      2. Modify Scoring Layers
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-modify-scoring-parameters" class="md-nav__link">
    <span class="md-ellipsis">
      3. Modify Scoring Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#4-specify-maximum-sequence-lengths" class="md-nav__link">
    <span class="md-ellipsis">
      4. Specify Maximum Sequence Lengths
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#5-specify-traceback-pointer-data-types-and-states" class="md-nav__link">
    <span class="md-ellipsis">
      5. Specify Traceback Pointer data types and states
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#6-specify-band-width-for-banding-kernels" class="md-nav__link">
    <span class="md-ellipsis">
      6. Specify Band Width (for banding kernels)
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#step-3-initialize-row-and-column-scores" class="md-nav__link">
    <span class="md-ellipsis">
      Step 3: Initialize row and column scores
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#step-4-specify-scoring-function" class="md-nav__link">
    <span class="md-ellipsis">
      Step 4: Specify Scoring function
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#step-5-specify-traceback-strategy" class="md-nav__link">
    <span class="md-ellipsis">
      Step 5: Specify Traceback Strategy
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#step-6-specify-parallelism" class="md-nav__link">
    <span class="md-ellipsis">
      Step 6: Specify Parallelism
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#build-and-simulate-new-kernels" class="md-nav__link">
    <span class="md-ellipsis">
      Build and simulate new kernels
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Build and simulate new kernels">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#step-1-install-dependencies" class="md-nav__link">
    <span class="md-ellipsis">
      Step 1: Install Dependencies
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#step-2-create-a-testbench" class="md-nav__link">
    <span class="md-ellipsis">
      Step 2: Create a testbench
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#step-3-build-and-run" class="md-nav__link">
    <span class="md-ellipsis">
      Step 3: Build and Run
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#synthesize-and-deploy-new-kernels" class="md-nav__link">
    <span class="md-ellipsis">
      Synthesize and deploy new kernels
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Synthesize and deploy new kernels">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#step-1-write-host-side-program" class="md-nav__link">
    <span class="md-ellipsis">
      Step 1: Write host-side program
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#step-2-install-dependencies" class="md-nav__link">
    <span class="md-ellipsis">
      Step 2: Install Dependencies
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#step-3-configure-the-project-using-json-file" class="md-nav__link">
    <span class="md-ellipsis">
      Step 3: Configure the project using JSON file
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Step 3: Configure the project using JSON file">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#json-parameters-explained" class="md-nav__link">
    <span class="md-ellipsis">
      JSON Parameters Explained
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#step-4-synthesize-the-kernel_1" class="md-nav__link">
    <span class="md-ellipsis">
      Step 4: Synthesize the kernel
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Step 4: Synthesize the kernel">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#explaining-command-line-arguments" class="md-nav__link">
    <span class="md-ellipsis">
      Explaining command-line arguments
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#step-4-analyze-the-implementation-output" class="md-nav__link">
    <span class="md-ellipsis">
      Step 4: Analyze the implementation output
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Step 4: Analyze the implementation output">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#details-of-the-output-files-generated" class="md-nav__link">
    <span class="md-ellipsis">
      Details of the output files generated
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#analyze-the-output-using-gui" class="md-nav__link">
    <span class="md-ellipsis">
      Analyze the output using GUI
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#step-5-generate-the-bitstream" class="md-nav__link">
    <span class="md-ellipsis">
      Step 5: Generate the bitstream
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#step-6-deploy-the-kernel-on-aws-f1-fpga" class="md-nav__link">
    <span class="md-ellipsis">
      Step 6: Deploy the kernel on AWS F1 FPGA
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#source-code-documentation" class="md-nav__link">
    <span class="md-ellipsis">
      Source Code Documentation
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#contributions" class="md-nav__link">
    <span class="md-ellipsis">
      Contributions
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#citing-dp-hls" class="md-nav__link">
    <span class="md-ellipsis">
      Citing DP-HLS
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  

  
    <a href="https://github.com/TurakhiaLab/DP-HLS/edit/master/docs/index.md" title="Edit this page" class="md-content__button md-icon">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M10 20H6V4h7v5h5v3.1l2-2V8l-6-6H6c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h4zm10.2-7c.1 0 .3.1.4.2l1.3 1.3c.2.2.2.6 0 .8l-1 1-2.1-2.1 1-1c.1-.1.2-.2.4-.2m0 3.9L14.1 23H12v-2.1l6.1-6.1z"/></svg>
    </a>
  
  
    
      
    
    <a href="https://github.com/TurakhiaLab/DP-HLS/raw/master/docs/index.md" title="View source of this page" class="md-content__button md-icon">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 18c.56 0 1 .44 1 1s-.44 1-1 1-1-.44-1-1 .44-1 1-1m0-3c-2.73 0-5.06 1.66-6 4 .94 2.34 3.27 4 6 4s5.06-1.66 6-4c-.94-2.34-3.27-4-6-4m0 6.5a2.5 2.5 0 0 1-2.5-2.5 2.5 2.5 0 0 1 2.5-2.5 2.5 2.5 0 0 1 2.5 2.5 2.5 2.5 0 0 1-2.5 2.5M9.27 20H6V4h7v5h5v4.07c.7.08 1.36.25 2 .49V8l-6-6H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h4.5a8.2 8.2 0 0 1-1.23-2"/></svg>
    </a>
  


<h1 id="dp-hls-a-high-level-synthesis-framework-for-accelerating-dynamic-programming-algorithms-in-bioinformatics">DP-HLS: A High-Level Synthesis Framework for Accelerating Dynamic Programming Algorithms in Bioinformatics</h1>
<div align="center">

<img src="images/dp_hls_logo.png"width="200" height="200" />

</div>

<h2 id="dp-hls-video-tutorial">DP-HLS Video Tutorial</h2>
<iframe width="1000" height="600" src="https://www.youtube.com/embed/BLF7QQvkVkk?si=fzizTrAL20_5lAiq" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" referrerpolicy="strict-origin-when-cross-origin" allowfullscreen></iframe>

<h2 id="introduction">Introduction</h2>
<p>Welcome to the official wiki of DP-HLS. DP-HLS is a framework designed to simplify and accelerate the development of a
broad set of bioinformatically relevant DP algorithms based on the 2-D DP paradigm using High-Level Synthesis (HLS). Built with the AMD Vitis HLS tool, DP-HLS offers extensive customizability, enabling users to create and implement FPGA-accelerated kernels tailored to their specific applications.</p>
<h3 id="2-d-dynamic-programming-paradigm">2-D Dynamic Programming Paradigm</h3>
<div align="center">

<img src="images/dp_steps.png"width="600" height="350" />

</div>

<p><br></p>
<p>Many bioinformatics problems involve comparing linear biological sequences (DNA, RNA, proteins) to identify similarities and differences. A common approach to this problem is using 2-D dynamic programming (DP) algorithms (2-D DP paradigm), which typically consists of three steps: i) initialization, ii) matrix fill, and iii) traceback. </p>
<p>The initialization step arranges the two sequences being compared on a 2-D grid, called DP matrix, with one sequence along the horizontal axis and the other along the vertical axis. The first row and column are initialized with predefined scores. Next, in the matrix fill step, a recursive formula is used to score each cell based on its three neighboring cells: above, left, and diagonal, allowing for ’gaps’ in sequences. Finally, the traceback step, which is optional in some algorithms, recovers the path in the DP matrix corresponding to the sequence of decisions giving the overall optimal score. </p>
<h3 id="variations-in-2-d-dynamic-programming-algorithms">Variations in 2-D Dynamic Programming algorithms</h3>
<p>Variations in general paradigm of 2-D Dynamic Programming has led to wide variety of algorithms used by bioinformatics tools in various applications. The table below lists some of the famous algorithms used in bioinformatics which is caused due to some variations in the scoring, initialization and traceback part of the general DP algorithmic template. These variations are described in <a href="#customize-new-kernels">Customize new kernels</a> section below.</p>
<table>
<thead>
<tr>
<th>Sl No.</th>
<th>Input Alphabets</th>
<th>Kernels</th>
<th>State-of-the-art Tools</th>
<th>Applications</th>
<th>Modifications in DP-HLS</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td>DNA</td>
<td>Global Linear Alignment (Needleman-Wunsch)</td>
<td><a href="https://blast.ncbi.nlm.nih.gov/Blast.cgi?PROGRAM=blastn&amp;PAGE_TYPE=BlastSearch&amp;LINK_LOC=blasthome">BLAST</a>, <a href="https://www.ebi.ac.uk/jdispatcher/psa/emboss_stretcher?stype=dna&amp;matrix=EDNAFULL&amp;gapopen=16&amp;gapext=4">EMBOSS Stretcher</a></td>
<td>Similarity Search</td>
<td></td>
</tr>
<tr>
<td>2</td>
<td>DNA</td>
<td>Global Affine Alignment (Gotoh)</td>
<td><a href="https://blast.ncbi.nlm.nih.gov/Blast.cgi?PROGRAM=blastn&amp;PAGE_TYPE=BlastSearch&amp;LINK_LOC=blasthome">BLAST</a>, <a href="https://www.ebi.ac.uk/jdispatcher/psa/emboss_needle?stype=dna&amp;matrix=EDNAFULL">EMBOSS Needle</a></td>
<td>Similarity Search with gaps</td>
<td>Scoring</td>
</tr>
<tr>
<td>3</td>
<td>DNA</td>
<td>Local Linear Alignment (Smith-Waterman)</td>
<td><a href="https://blast.ncbi.nlm.nih.gov/Blast.cgi?PROGRAM=blastn&amp;PAGE_TYPE=BlastSearch&amp;LINK_LOC=blasthome">BLAST</a>, <a href="https://www.ebi.ac.uk/jdispatcher/sss/fasta/nucleotide">FASTA</a>, <a href="https://genome.ucsc.edu/cgi-bin/hgBlat">BLAT</a></td>
<td>Gene finding, Motif detection</td>
<td>Initialization and Traceback</td>
</tr>
<tr>
<td>4</td>
<td>DNA</td>
<td>Local Affine Alignment (Smith-Waterman-Gotoh)</td>
<td><a href="https://blast.ncbi.nlm.nih.gov/Blast.cgi?PROGRAM=blastn&amp;PAGE_TYPE=BlastSearch&amp;LINK_LOC=blasthome">BLAST</a>, <a href="https://www.bx.psu.edu/~rsharris/lastz/">LASTZ</a></td>
<td>Gene finding, Motif detection</td>
<td>Scoring, Initialization and Traceback</td>
</tr>
<tr>
<td>5</td>
<td>DNA</td>
<td>Global Two-piece Affine Alignment</td>
<td><a href="https://github.com/lh3/minimap2">Minimap2</a></td>
<td>Long Read Alignment</td>
<td>Scoring</td>
</tr>
<tr>
<td>6</td>
<td>DNA</td>
<td>Overlap Alignment</td>
<td><a href="https://canu.readthedocs.io/en/latest/tutorial.html">CANU</a>, <a href="https://github.com/mikolmogorov/Flye">Flye</a></td>
<td>Whole Genome Assembly</td>
<td>Initialization and Traceback</td>
</tr>
<tr>
<td>7</td>
<td>DNA</td>
<td>Semi-global Alignment</td>
<td><a href="https://bio-bwa.sourceforge.net/">BWA-MEM</a></td>
<td>Whole Genome Assembly</td>
<td>Initialization and Traceback</td>
</tr>
<tr>
<td>8</td>
<td>Seq. Profiles</td>
<td>Profile Alignment</td>
<td><a href="https://www.genome.jp/tools-bin/clustalw">CLUSTALW</a>, <a href="https://www.ebi.ac.uk/jdispatcher/msa/muscle?stype=protein">MUSCLE</a></td>
<td>Multiple Sequence Alignment</td>
<td>Sequence Alphabet and Scoring</td>
</tr>
<tr>
<td>9</td>
<td>Complex Nos.</td>
<td>Dynamic Time Wrapping Algorithm (DTW)</td>
<td><a href="https://github.com/Psy-Fer/SquiggleKit">SquiggleKit</a></td>
<td>Basecalling</td>
<td>Sequence Alphabet and Scoring</td>
</tr>
<tr>
<td>10</td>
<td>DNA</td>
<td>Viterbi Algorithm (PairHMM)</td>
<td><a href="http://hmmer.org/">HMMER</a>, <a href="https://bioinf.uni-greifswald.de/augustus/">Augustus</a></td>
<td>Remote Homology Search</td>
<td>Scoring (no Traceback)</td>
</tr>
<tr>
<td>11</td>
<td>DNA</td>
<td>Banded Global Linear Alignment</td>
<td><a href="https://blast.ncbi.nlm.nih.gov/Blast.cgi?PROGRAM=blastn&amp;PAGE_TYPE=BlastSearch&amp;LINK_LOC=blasthome">BLAST</a>, <a href="https://bowtie-bio.sourceforge.net/index.shtml">Bowtie</a></td>
<td>Fast local alignment</td>
<td>Scoring and Initialization</td>
</tr>
<tr>
<td>12</td>
<td>DNA</td>
<td>Banded Local Affine Alignment</td>
<td><a href="https://github.com/lh3/minimap2">Minimap2</a></td>
<td>Long read alignment</td>
<td>Initialization, Scoring (no Traceback)</td>
</tr>
<tr>
<td>13</td>
<td>DNA</td>
<td>Banded Global Two-piece Affine Alignment</td>
<td><a href="https://github.com/lh3/minimap2">Minimap2</a></td>
<td>Long read alignment</td>
<td>Scoring, Initialization and Traceback</td>
</tr>
<tr>
<td>14</td>
<td>Integers</td>
<td>Semi-global DTW (sDTW)</td>
<td><a href="https://github.com/TimD1/SquiggleFilter">SquiggleFilter</a>, <a href="https://github.com/CMU-SAFARI/RawHash">RawHash</a></td>
<td>Basecalling</td>
<td>Sequence Alphabet and Scoring</td>
</tr>
<tr>
<td>15</td>
<td>Amino acids</td>
<td>Local Linear Alignment with protein sequences</td>
<td><a href="https://www.ebi.ac.uk/jdispatcher/psa/emboss_water">EMBOSS Water</a>, <a href="https://blast.ncbi.nlm.nih.gov/Blast.cgi?PROGRAM=blastp&amp;PAGE_TYPE=BlastSearch&amp;BLAST_SPEC=&amp;LINK_LOC=blasttab&amp;LAST_PAGE=blastn">BLASTp</a>, <a href="https://github.com/bbuchfink/diamond">DIAMOND</a></td>
<td>Protein Local Alignment</td>
<td>Sequence Alphabet and Scoring</td>
</tr>
</tbody>
</table>
<h3 id="dp-hls-framework">DP-HLS Framework</h3>
<div align="center">

<img src="images/dp-hls_poster.png"width="200" height="350" />

<figcaption>Image above shows steps of execution from user configuration to deployment of kernels</figcaption>

</div>

<p></br></p>
<div align="center">

<img src="images/hls_frontend.png"width="600" height="350" />

<figcaption>Image above illustrates the layout of DP-HLS Front-end component with customizable and parallelizable blocks</figcaption>

</div>

<p>The DP-HLS framework is composed of two main components: the front-end and the back-end. The front-end component allows users to specify or customize new kernels in C/C++ by modifying certain parameters and code blocks. After configuring the HLS framework to create a kernel as per your usecases, then user needs to simulate, verify and synthesize the kernel. Once done, the kernel is ready to be deployed to FPGA after incorporating the host code. The above figure depicts the various stages of the front-end design flow. </p>
<p>The back-end component of the DP-HLS framework contains a fixed set of HLS directives or pragmas that provide the HLS compiler with the necessary hints to efficiently map the front-end kernel design specification into an optimized RTL implementation  to be deployed to FPGA without requiring digital design expertise. </p>
<h2 id="features">Features</h2>
<ol>
<li><strong>Easy customization of algorithms</strong>: HLS-based open-source framework streamlines the creation of FPGA accelerators for
new algorithms. To implement any custom algorithm, only the scoring functions and a few parameters need to be modified without requiring an in-depth RTL or digital design experience.</li>
<li><strong>Easy deployment into hardware</strong>: The framework allows the user to implement highly customized FPGA kernels to deploy within days, whereas developing in HDL takes months.</li>
<li><strong>Supports complex 2-D DP based algorithms</strong>: DP-HLS supports the creation of Viterbi Algorithm, Multiple Sequence Alignment and Dynamic Time Warping Algorithm based kernels in a common framework for the first time. </li>
<li><strong>Faster kernels compared to baselines</strong>: DP-HLS based kernel implementation showed up to 32x improvements in throughput over CPU baselines and comparable results (within 7.7% to 16.8% margin) to hand-crafted RTL implementations, with the added benefit of easier design configurability.</li>
</ol>
<h2 id="demo-video">Demo Video</h2>
<iframe width="1000" height="600" src="https://youtu.be/FDARlKDjDPY?si=2lRKJuqQ9D1TSZo0" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" referrerpolicy="strict-origin-when-cross-origin" allowfullscreen></iframe>

<h2 id="quick-start">Quick Start</h2>
<p>To create, customize and deploy your own kernel on FPGA using DP-HLS framwork, it requires a series of steps to be executed. We have already developed pre-built templates of some of the well known algorithms listed in table 1. These pre-built templates are simulated using standard C++, synthesized using AMD Vitis HLS 2021.2 toolchain on 8-core Amazon EC2 z1d instance and deployed on Amazon EC2 F1 instance based FPGA.</p>
<p>The following sections mentions the steps to quickly simulate, synthesize and deploy global affine kernel which incorporates Needleman-Wunsch algorithm with affine gap penalty. Similar steps need to be followed for other pre-built kernel templates as well. To create and execute your own custom kernel, please refer to the sections which describes all possible commands and parameters supported by DP-HLS - <a href="#customize-new-kernels">Customize new kernels</a>, <a href="#build-and-simulate-new-kernels">Build and simulate new kernels</a> and <a href="#synthesize-and-deploy-new-kernels">Synthesize and deploy new kernels</a>. </p>
<h3 id="step-0-create-aws-instances">Step 0: Create AWS instances</h3>
<p>To use our DP-HLS framework quickly to build and run the kernels, it would be preferrable to use AWS instances which comes with the AWS FPGA Developer AMI containing AMD Vitis 2021.2. </p>
<h3 id="step-1-clone-the-dp-hls-repository-from-github">Step 1: Clone the DP-HLS repository from GitHub</h3>
<p>The DP-HLS repo can be cloned using the following commands.</p>
<p><div class="highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a>git<span class="w"> </span>clone<span class="w"> </span>https://github.com/TurakhiaLab/DP-HLS.git
</code></pre></div>
or <code>ssh</code> to :
<div class="highlight"><pre><span></span><code><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a>git<span class="w"> </span>clone<span class="w"> </span>git@github.com:TurakhiaLab/DP-HLS.git
</code></pre></div></p>
<h3 id="step-2-install-the-required-dependencies">Step 2: Install the required dependencies</h3>
<p>Please make sure the following dependencies are installed in your system.</p>
<ul>
<li>g++ &gt;= 4.8.5</li>
<li>Python &gt; 3.6</li>
</ul>
<h3 id="step-3-build-and-simulate-the-kernel">Step 3: Build and simulate the kernel</h3>
<p>Once the repository is cloned and dependencies are installed, run the following command to build and simulate the kernel.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-2-1" name="__codelineno-2-1" href="#__codelineno-2-1"></a>mkdir<span class="w"> </span>build<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nb">cd</span><span class="w"> </span>build
<a id="__codelineno-2-2" name="__codelineno-2-2" href="#__codelineno-2-2"></a>cmake<span class="w"> </span>..
<a id="__codelineno-2-3" name="__codelineno-2-3" href="#__codelineno-2-3"></a>make<span class="w"> </span>global_affine<span class="w"> </span>
</code></pre></div>
<h3 id="step-4-synthesize-the-kernel">Step 4: Synthesize the kernel</h3>
<p>Once the build is complete, you need to configure the file <code>config.json</code> under <code>demo/global_affine</code> by providing the DP-HLS folder path. This pre-configured JSON file will compile and synthesize the Global Affine kernel with <code>MAX_QUERY_LENGTH</code> and <code>MAX_REFERENCE_LENGTH</code> as 256 each along with 32 PEs, 2 Blocks, and 1 Compute Unit. The input clock frequency is set to 250 MHz. </p>
<p><div class="highlight"><pre><span></span><code><a id="__codelineno-3-1" name="__codelineno-3-1" href="#__codelineno-3-1"></a><span class="p">{</span>
<a id="__codelineno-3-2" name="__codelineno-3-2" href="#__codelineno-3-2"></a><span class="w">    </span><span class="nt">&quot;size&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-3-3" name="__codelineno-3-3" href="#__codelineno-3-3"></a><span class="w">        </span><span class="nt">&quot;max_problem_size&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<a id="__codelineno-3-4" name="__codelineno-3-4" href="#__codelineno-3-4"></a><span class="w">            </span><span class="p">{</span><span class="nt">&quot;max_query_length&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">256</span><span class="p">,</span><span class="w"> </span><span class="nt">&quot;max_reference_length&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">256</span><span class="p">}</span>
<a id="__codelineno-3-5" name="__codelineno-3-5" href="#__codelineno-3-5"></a><span class="w">        </span><span class="p">],</span>
<a id="__codelineno-3-6" name="__codelineno-3-6" href="#__codelineno-3-6"></a><span class="w">        </span><span class="nt">&quot;pe_num&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="mi">32</span><span class="p">],</span>
<a id="__codelineno-3-7" name="__codelineno-3-7" href="#__codelineno-3-7"></a><span class="w">        </span><span class="nt">&quot;blocks&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="mi">2</span><span class="p">],</span>
<a id="__codelineno-3-8" name="__codelineno-3-8" href="#__codelineno-3-8"></a><span class="w">        </span><span class="nt">&quot;cu&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
<a id="__codelineno-3-9" name="__codelineno-3-9" href="#__codelineno-3-9"></a><span class="w">    </span><span class="p">},</span>
<a id="__codelineno-3-10" name="__codelineno-3-10" href="#__codelineno-3-10"></a><span class="w">    </span><span class="nt">&quot;kernel&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-3-11" name="__codelineno-3-11" href="#__codelineno-3-11"></a><span class="w">        </span><span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;seq_align_multiple_static&quot;</span><span class="p">,</span>
<a id="__codelineno-3-12" name="__codelineno-3-12" href="#__codelineno-3-12"></a><span class="w">        </span><span class="nt">&quot;clock_frequency&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">250000000</span>
<a id="__codelineno-3-13" name="__codelineno-3-13" href="#__codelineno-3-13"></a><span class="w">    </span><span class="p">},</span>
<a id="__codelineno-3-14" name="__codelineno-3-14" href="#__codelineno-3-14"></a><span class="w">    </span><span class="nt">&quot;design&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-3-15" name="__codelineno-3-15" href="#__codelineno-3-15"></a><span class="w">        </span><span class="nt">&quot;path_params&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;&lt;dp_hls_root&gt;/DP-HLS/demo/global_affine/design&quot;</span><span class="p">,</span>
<a id="__codelineno-3-16" name="__codelineno-3-16" href="#__codelineno-3-16"></a><span class="w">        </span><span class="nt">&quot;path_frontend&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;&lt;dp_hls_root&gt;/demo/global_affine/design/kernel_global_affine.cpp&quot;</span><span class="p">,</span>
<a id="__codelineno-3-17" name="__codelineno-3-17" href="#__codelineno-3-17"></a><span class="w">        </span><span class="nt">&quot;dp-hls_root&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;&lt;dp_hls_root&gt;&quot;</span><span class="p">,</span>
<a id="__codelineno-3-18" name="__codelineno-3-18" href="#__codelineno-3-18"></a><span class="w">        </span><span class="nt">&quot;host_program&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;&lt;dp_hls_root&gt;/DP-HLS/src/hosts/host_ocl_global.cpp&quot;</span>
<a id="__codelineno-3-19" name="__codelineno-3-19" href="#__codelineno-3-19"></a><span class="w">    </span><span class="p">},</span>
<a id="__codelineno-3-20" name="__codelineno-3-20" href="#__codelineno-3-20"></a><span class="w">    </span><span class="nt">&quot;output_path&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;&lt;dp_hls_root&gt;/demo/global_affine/output/compile&quot;</span><span class="p">,</span>
<a id="__codelineno-3-21" name="__codelineno-3-21" href="#__codelineno-3-21"></a><span class="w">    </span><span class="nt">&quot;output_name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;global_affine&quot;</span><span class="p">,</span>
<a id="__codelineno-3-22" name="__codelineno-3-22" href="#__codelineno-3-22"></a><span class="w">    </span><span class="nt">&quot;build&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-3-23" name="__codelineno-3-23" href="#__codelineno-3-23"></a><span class="w">        </span><span class="nt">&quot;build_type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;hw&quot;</span>
<a id="__codelineno-3-24" name="__codelineno-3-24" href="#__codelineno-3-24"></a><span class="w">    </span><span class="p">},</span>
<a id="__codelineno-3-25" name="__codelineno-3-25" href="#__codelineno-3-25"></a><span class="w">    </span><span class="nt">&quot;vitis_hls&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-3-26" name="__codelineno-3-26" href="#__codelineno-3-26"></a><span class="w">        </span><span class="nt">&quot;cosim_testbench&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;&lt;dp_hls_root&gt;/DP-HLS/testbench/test_csim_global_affine.cpp&quot;</span><span class="p">,</span>
<a id="__codelineno-3-27" name="__codelineno-3-27" href="#__codelineno-3-27"></a><span class="w">        </span><span class="nt">&quot;output_path&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;&lt;dp_hls_root&gt;/demo/global_affine/output/cosim&quot;</span><span class="p">,</span>
<a id="__codelineno-3-28" name="__codelineno-3-28" href="#__codelineno-3-28"></a><span class="w">        </span><span class="nt">&quot;export_design&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span>
<a id="__codelineno-3-29" name="__codelineno-3-29" href="#__codelineno-3-29"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-3-30" name="__codelineno-3-30" href="#__codelineno-3-30"></a><span class="p">}</span>
</code></pre></div>
Once the JSON file is configured as mentioned above, run the following command for compiling and synthesizing the Global Affine kernel. </p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-4-1" name="__codelineno-4-1" href="#__codelineno-4-1"></a><span class="n">python</span> <span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">centos</span><span class="o">/</span><span class="n">workspace</span><span class="o">/</span><span class="n">DP</span><span class="o">-</span><span class="n">HLS</span><span class="o">/</span><span class="n">py</span><span class="o">-</span><span class="n">hls</span><span class="o">/</span><span class="n">parallel_compile</span><span class="o">.</span><span class="n">py</span> <span class="o">--</span><span class="n">config</span> <span class="o">&lt;</span><span class="n">dp_hls_root</span><span class="o">&gt;/</span><span class="n">demo</span><span class="o">/</span><span class="n">global_affine</span><span class="o">/</span><span class="n">config</span><span class="o">.</span><span class="n">json</span> <span class="o">--</span><span class="nb">compile</span> <span class="kc">True</span> <span class="o">--</span><span class="n">num_workers</span> <span class="mi">1</span> <span class="o">--</span><span class="nb">all</span> <span class="kc">True</span>
</code></pre></div>
<p>After completion of this step, an <code>.xclbin</code> file will be generated which is the bitstream file, used for deploying the kernel on the FPGA device. </p>
<!-- !!! Note
    The `params.h` file used in the Step 3 differs from the `params.h` file used in this step. The difference is that the `params.h` used here have the kernel size related macro definitions removed to avoid conflict definition when compiling a batch of kernels with the `config.json` file, which defines the kernel size dynamically with the compile flags.  -->

<h3 id="step-5-deploy-the-kernel-on-fpga">Step 5: Deploy the kernel on FPGA</h3>
<p>Once the compilation is done and the <code>.xclbin</code> bitsteram is generated, you need to create an AFI to deploy the kernel. This can be done on any platform. However, we prefer using AWS instances which has AWS FPGA Developer AMI containing AMD Vitis 2021.2.  </p>
<p>First you need to create a S3 bucket for the design checkpoint (DCP) and the logs. </p>
<p><strong>1. Create AFI</strong></p>
<p>Execute the following commands to create an AFI for kernel deployment. </p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-5-1" name="__codelineno-5-1" href="#__codelineno-5-1"></a>git<span class="w"> </span>clone<span class="w"> </span>https://github.com/aws/aws-fpga.git<span class="w">  </span><span class="c1"># Clone the AWS FPGA Repo</span>
<a id="__codelineno-5-2" name="__codelineno-5-2" href="#__codelineno-5-2"></a><span class="nb">source</span><span class="w"> </span>aws-fpga/vitis_setup.sh<span class="w">     </span><span class="c1"># Setup the Vitis HLS</span>
<a id="__codelineno-5-3" name="__codelineno-5-3" href="#__codelineno-5-3"></a><span class="nb">cd</span><span class="w"> </span>&lt;dp_hls_root&gt;/demo/global_affine/output/compile<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>&lt;aws_fpga_repo_path&gt;/Vitis/tools/create_vitis_afi.sh<span class="w"> </span>-xclbin<span class="o">=</span>./build_dir.hw.xilinx_aws-vu9p-f1_shell-v04261818_201920_3/seq_align_kernel.xclbin<span class="w"> </span>-o<span class="o">=</span>./global_affine<span class="w"> </span>-s3_bucket<span class="o">=</span>&lt;s3_bucket_name&gt;<span class="w"> </span>-s3_dcp_key<span class="o">=</span>&lt;s3_dcp_folder&gt;<span class="w"> </span>-s3_logs_key<span class="o">=</span>&lt;s3_logs_folder&gt;
</code></pre></div>
<p><strong>2. Waiting for the AFI to ready</strong> </p>
<p>You can check whether an AFI is ready using <code>aws ec2 describe-fpga-images --fpga-image-ids &lt;AFI ID&gt;</code>. The AFI is ready to use if the status of the code is available, as shown below. </p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-6-1" name="__codelineno-6-1" href="#__codelineno-6-1"></a><span class="err">...</span>
<a id="__codelineno-6-2" name="__codelineno-6-2" href="#__codelineno-6-2"></a><span class="nt">&quot;State&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-6-3" name="__codelineno-6-3" href="#__codelineno-6-3"></a><span class="w">    </span><span class="nt">&quot;Code&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;available&quot;</span>
<a id="__codelineno-6-4" name="__codelineno-6-4" href="#__codelineno-6-4"></a><span class="p">},</span>
<a id="__codelineno-6-5" name="__codelineno-6-5" href="#__codelineno-6-5"></a><span class="err">...</span>
</code></pre></div>
<p><strong>3. Run the kernel</strong> </p>
<p>You can now run the kernel on AWS F1 FPGA based instances. </p>
<p><strong>AWS instance creation</strong>: AWS F1 instance creation can be done with two methods. The first method is to change the instance type of the development instance to be <code>f1.2xlarge</code>. The another method is to create an EFS that are capable share files across multiple instances; then you create a new F1 instance with AWS-FPGA repo cloned in it and upload the compilation output folder to the EFS for sharing between the Development and Deployment instance. </p>
<p>Once you are on the F1 instance, after you can access the compiled bitstream, you can start the kernel by running:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-7-1" name="__codelineno-7-1" href="#__codelineno-7-1"></a>./dp-hls_host<span class="w"> </span>global_affine.awsxclbin
</code></pre></div>
<h2 id="customize-new-kernels">Customize new kernels</h2>
<p>This section mention detailed steps to create and customize your own kernel based on specific requirements. Once the kernels are customized, then it will be ready for simulation, synthesis and deployment. We also mention the details on how to build and simulate your kernel to verify the implementation in the section <a href="#build-and-simulate-new-kernels">Build and simulate new kernels</a> as well as how to synthesize and deploy it on AWS F1 FPGA instances (FPGA device in which we tested our pre-built kernel templates) in the section <a href="#synthesize-and-deploy-new-kernels">Synthesize and deploy new kernels</a>.</p>
<h3 id="step-1-understanding-variations-in-2-d-dynamic-programming-paradigm">Step 1: Understanding variations in 2-D Dynamic Programming paradigm</h3>
<p>Before starting, it is preferred to go through and understand the existing variations in 2-D DP paradigm before diving deep into the customization step. </p>
<p>All kernels follow a general template for 2-D dynamic programming paradigm. However, subtle variations lead to creation of different types of algorithms for different usecases (check out algorithms and their corresponding variations listed in table 1). Some of the variations are mentioned in subsequent sections below. </p>
<h4 id="variations-in-initialization-step">Variations in Initialization Step</h4>
<div align="center">

<img src="images/background_variation_initialization.png"width="400" height="400" />

</div>

<p><br></p>
<p>For the execution of dynamic progamming, the first row and column of the 2-D DP matrix needs to be initialized. User can provide their own initial scores for the first row and column depending on the usecases. Depending on which traceback strategy (described below) is used, the scores could be a constant (e.g., 0 or -∞) or a function of the gap penalties.</p>
<h4 id="variations-in-traceback-step">Variations in Traceback Step</h4>
<div align="center">

<img src="images/background_variation_traceback.png"width="500" height="420" />

</div>

<p><br></p>
<p>Traceback step determine the path that results in the optimal score. While the recurrence scoring equations specify the optimal transitions on a path, depending on the usecases, the traceback strategy determines where to start and end the traceback path. There are variations seen in the traceback step for mainly four categories of alignments algorithms: global, local, semi-global, and overlap. User can have their own traceback strategy depending on their requirements. </p>
<ol>
<li>Global strategy performs end-to-end comparison of sequences, with traceback starting from the bottom-right cell of the 2-D DP matrix to the top-left cell. This is commonly used when two corresponding sequences, e.g., gene sequences, are being compared. </li>
<li>Local strategy finds the most similar subsequences and is ideally suited for identifying conserved motifs or functional regions in sequences. Here, the traceback begins from the highest-scoring cell and stops at a 0-scoring cell.</li>
<li>Semi-global strategy allows paths spanning one sequence end-to-end with a sub-sequence of the other. Here, the traceback begins from the highest-scoring cell in the bottom row of the 2-D DP matrix and continues to the top row. </li>
<li>Overlap strategy matches sub-sequences at the beginning of one sequence and at the end of the other. This algorithm finds applications in genome assembly. Here, the traceback starts from the highest-scoring cell in the rightmost column (bottom row) of the 2-D DP matrix and continues to the top row (leftmost column).</li>
</ol>
<h4 id="variations-in-scoring-logic">Variations in Scoring Logic</h4>
<div align="center">

<img src="images/background_variation_scoring.png"width="700" height="600" />

</div>

<p><br></p>
<p>Scoring of the cells in the 2-D DP paradigm refers to the recurrence equations used to calculate the individual scores of cells in the 2-D grid. Equations reward matches or similarities of characters in the two sequences being compared and penalize mismatches or gaps. Several variations of scoring strategies are commonly used in bioinformatics applications as shown in the above figure. User can specify their own scoring equation for their custom algorithmic requirement. </p>
<h4 id="variations-in-input-alphabets">Variations in Input Alphabets</h4>
<div align="center">

<img src="images/background_variation_input.png"width="700" height="250" />

</div>

<p><br></p>
<p>An alphabet refers to the set of characters used to represent the sequences being compared, such as DNA, RNA, or protein sequences, which consists of 4 or 20 characters, although variations may exist. In DNA based kernel algorithms, sequences are represented as 4 different nucleotides, with extra N representing the ambiguous bases. Multiple sequence alignment inputs are represented as profiles which is a tuple of 5 (21) integers, referring to the frequencies of 4 nucleotides. For RNA based alignments, inputs alphabets are represented as 20 different characters corresponding to amino acids. Dynamic Time Warping based alignments, used in signal processing to compare two time-series signals, uses real or complex number values as input alphabets. </p>
<p>Hence for different types of algorithms, there can be differences in types of input alphabets and their representation, provided by the user. </p>
<h3 id="step-2-customize-data-types-and-parameters">Step 2: Customize data types and parameters</h3>
<p>Step 2-6 describes how to configure and customize your own kernel. The customization steps involve changes in few parameters as well as addition/modification of few code blocks as mentioned. Once you are aware of the variations that exists and how it leads to different algorithms (described in step 1), it will be easier to configure parameters. </p>
<p>DP-HLS framework supports custom data types of all kernels with variable precision for scoring, traceback, and internal logic indices. This flexibility enables users to attain optimal computational efficiency according to the specific needs of their kernels. </p>
<p>The possible datatype and parameter customization supported by DP-HLS is described in this step below.</p>
<h4 id="1-modify-sequence-alphabet">1. Modify Sequence Alphabet</h4>
<p>To modify the sequence alphabets of the inputs of custom kernels, define an arbitrary user-defined datatype <code>char_t</code> as follows. The example mentions a 2-bit precision integer used to define char_t. This alphabet represents the four nucleotide bases <code>A</code>,<code>C</code>,<code>G</code>,<code>T</code> within the custom kernels requiring DNA sequences as input. </p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-8-1" name="__codelineno-8-1" href="#__codelineno-8-1"></a><span class="k">typedef</span><span class="w"> </span><span class="n">ap_uint</span><span class="o">&lt;</span><span class="mi">2</span><span class="o">&gt;</span><span class="w"> </span><span class="n">char_t</span><span class="p">;</span>
</code></pre></div>
<p>To define input alphabets for Dynamic Time Warping (DTW) kernels, DP-HLS requires user to define a struct (shown below) consisting of two 32-bit fixed-point numbers to represent the real and imaginary parts of the two temporal signals (which take complex values) being compared by the kernel.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-9-1" name="__codelineno-9-1" href="#__codelineno-9-1"></a><span class="k">struct</span><span class="w"> </span><span class="nc">char_t_st</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-9-2" name="__codelineno-9-2" href="#__codelineno-9-2"></a><span class="w">    </span><span class="n">ap_fixed</span><span class="w"> </span><span class="o">&lt;</span><span class="mi">32</span><span class="p">,</span><span class="mi">26</span><span class="o">&gt;</span><span class="w"> </span><span class="n">real</span><span class="p">,</span><span class="w"> </span><span class="n">imag</span><span class="p">;</span>
<a id="__codelineno-9-3" name="__codelineno-9-3" href="#__codelineno-9-3"></a><span class="w">    </span><span class="p">};</span>
<a id="__codelineno-9-4" name="__codelineno-9-4" href="#__codelineno-9-4"></a>
<a id="__codelineno-9-5" name="__codelineno-9-5" href="#__codelineno-9-5"></a><span class="k">typedef</span><span class="w"> </span><span class="n">char_t_st</span><span class="w"> </span><span class="n">char_t</span><span class="w"> </span>
</code></pre></div>
<h4 id="2-modify-scoring-layers">2. Modify Scoring Layers</h4>
<p>To design and customize a 2-D DP kernel that involves multiple recurrence equations, each computing a unique value per cell, DP-HLS provides a variable called <code>N_LAYERS</code> which configures the number of unique values computed and stored per cell of the DP matrix. </p>
<p>For example, for affine-gap penalty based kernels, which uses 3 recurrence equations, <code>N_LAYERS</code> is set to 3. For two-level affine-gap penalty based kernels, set it to 5 for 5 layers of DP-matrix, each governed by one recurrence equation. </p>
<h4 id="3-modify-scoring-parameters">3. Modify Scoring Parameters</h4>
<p>For a custom kernel, specify arbitrary number of scoring parameters used by the kernels, each of arbitrary data types in a C/C++ struct called <code>ScoringParams</code>. The following example shows the definition of <code>ScoringParams</code> for Global Linear Kernel which uses 3 parameters: match, mismatch and one linear gap penalty. </p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-10-1" name="__codelineno-10-1" href="#__codelineno-10-1"></a><span class="k">struct</span><span class="w"> </span><span class="nc">ScoringParams</span><span class="w"> </span><span class="p">{</span><span class="w"> </span>
<a id="__codelineno-10-2" name="__codelineno-10-2" href="#__codelineno-10-2"></a><span class="w">    </span><span class="n">type_t</span><span class="w"> </span><span class="n">mismatch</span><span class="p">;</span>
<a id="__codelineno-10-3" name="__codelineno-10-3" href="#__codelineno-10-3"></a><span class="w">    </span><span class="n">type_t</span><span class="w"> </span><span class="n">match</span><span class="p">;</span>
<a id="__codelineno-10-4" name="__codelineno-10-4" href="#__codelineno-10-4"></a><span class="w">    </span><span class="n">type_t</span><span class="w"> </span><span class="n">linear_gap</span><span class="p">;</span>
<a id="__codelineno-10-5" name="__codelineno-10-5" href="#__codelineno-10-5"></a><span class="p">}</span><span class="w"> </span><span class="n">params</span><span class="p">;</span>
</code></pre></div>
<p>Viterbi algorithm for pairHMMs requires three hidden states (M-Match/Mismatch, I-Insertion and D-Deletion) and a total of 27 parameters including two transition probabilities between three hidden states and 5x5 matrix storing the emission probabilities for all pairs of character (<code>A</code>,<code>C</code>,<code>G</code>,<code>T</code>) in the M states. The following example illustrates the definition of struct <code>ScoringParams</code> used for designing Viterbi Algorithm. </p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-11-1" name="__codelineno-11-1" href="#__codelineno-11-1"></a><span class="k">struct</span><span class="w"> </span><span class="nc">ScoringParams</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-11-2" name="__codelineno-11-2" href="#__codelineno-11-2"></a><span class="w">    </span><span class="n">type_t</span><span class="w"> </span><span class="n">log_mu</span><span class="w"> </span><span class="p">;</span>
<a id="__codelineno-11-3" name="__codelineno-11-3" href="#__codelineno-11-3"></a><span class="w">    </span><span class="n">type_t</span><span class="w"> </span><span class="n">log_lambda</span><span class="w"> </span><span class="p">;</span>
<a id="__codelineno-11-4" name="__codelineno-11-4" href="#__codelineno-11-4"></a><span class="w">    </span><span class="n">type_t</span><span class="w"> </span><span class="n">emission</span><span class="w"> </span><span class="p">[</span><span class="mi">5</span><span class="p">][</span><span class="mi">5</span><span class="p">];</span>
<a id="__codelineno-11-5" name="__codelineno-11-5" href="#__codelineno-11-5"></a><span class="p">}</span><span class="w"> </span><span class="n">params</span><span class="w"> </span><span class="p">;</span>
</code></pre></div>
<h4 id="4-specify-maximum-sequence-lengths">4. Specify Maximum Sequence Lengths</h4>
<p>DP-HLS requires users to set the maximum sequence lengths for the input reference and query using <code>MAX_REFERENCE_LENGTH</code> and <code>MAX_QUERY_LENGTH</code> to determine the memory sizes for storing sequences and traceback pointers on the FPGA device. This allows user to execute kernels with sequence lengths smaller than or equal to maximum configured lengths without reimplementing the kernel. </p>
<h4 id="5-specify-traceback-pointer-data-types-and-states">5. Specify Traceback Pointer data types and states</h4>
<p>To specify the datatype for traceback pointers, define the datatype <code>tb_t</code> as arbitrary precision integers (<code>ap_uint&lt;2&gt;</code> for Global Linear Kernel and <code>ap_uint&lt;4&gt;</code> for Global Affine Kernel since both kernels require a 2-bit and 4-bit traceback pointer, respectively). 2-bit traceback pointer is used to point any one position out of 3 positions (up, left and diagonal) for each of the cell. Among 4-bit traceback pointer used by Global Affine, 2-bit is used for direction mentioned above. Upper 2 bits are used for choosing one layer out of three layers in affine gap penalty based kernels. </p>
<p>The traceback logic in the final step of DP algorithms is equivalent to a finite state machine (FSM) in which the current state <code>tb_curr_state</code> and the traceback matrix determine the next state <code>tb_next_state</code>, and the state transitions translate to the traceback path. The users are required to enumerate the possible traceback states in the variable <code>TB_STATE</code> as shown below.</p>
<p>The following example enumerates three states — <code>MM</code>, <code>INS</code>, and <code>DEL</code> — in the Global Linear kernel representing the three possible states of traceback pointers based on its recurrence equation.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-12-1" name="__codelineno-12-1" href="#__codelineno-12-1"></a><span class="k">enum</span><span class="w"> </span><span class="nc">TB_STATE</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-12-2" name="__codelineno-12-2" href="#__codelineno-12-2"></a><span class="w">    </span><span class="n">MM</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">INS</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">DEL</span>
<a id="__codelineno-12-3" name="__codelineno-12-3" href="#__codelineno-12-3"></a><span class="p">}</span><span class="w"> </span><span class="n">tb_next_state</span><span class="p">,</span><span class="w"> </span><span class="n">tb_curr_state</span><span class="w"> </span><span class="p">;</span>
</code></pre></div>
<p>The following example shows for the Global Affine kernel, where the two additional recurrence equations for long gap scores <code>LONG_INS</code> and <code>LONG_DEL</code> (long deletion and long insertion respectively) each add a traceback state. </p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-13-1" name="__codelineno-13-1" href="#__codelineno-13-1"></a><span class="k">enum</span><span class="w"> </span><span class="nc">TB_STATE</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-13-2" name="__codelineno-13-2" href="#__codelineno-13-2"></a><span class="w">    </span><span class="n">MM</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">INS</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">DEL</span><span class="w"> </span><span class="p">,</span>
<a id="__codelineno-13-3" name="__codelineno-13-3" href="#__codelineno-13-3"></a><span class="w">    </span><span class="n">LONG_INS</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">LONG_DEL</span>
<a id="__codelineno-13-4" name="__codelineno-13-4" href="#__codelineno-13-4"></a><span class="p">}</span><span class="w"> </span><span class="n">tb_next_state</span><span class="p">,</span><span class="w"> </span><span class="n">tb_curr_state</span><span class="w"> </span><span class="p">;</span>
</code></pre></div>
<h4 id="6-specify-band-width-for-banding-kernels">6. Specify Band Width (for banding kernels)</h4>
<p>DP-HLS allows user to opt the banding search space pruning strategy in their custom kernel by setting the macro
<code>BANDING</code> to <code>FIXED</code> and <code>BANDWIDTH</code> to the desired band size. <code>BANDING</code> is set to <code>RECTANGULAR</code> by default or if no banding is needed.</p>
<h3 id="step-3-initialize-row-and-column-scores">Step 3: Initialize row and column scores</h3>
<p>Once the parameters are specified based on requirements (described in step 2), now its time to add/modify code blocks for initialization, scoring and traceback logic for your own custom kernel. This step shows how to add your own column and row initialization scores as the first step in the 2-D DP paradigm. </p>
<p>To provide the initial row and column scores to the custom kernel for the initial step, specify the values of the 2-D arrays <code>init_row_scr</code> and <code>init_col_scr</code>. Each array is of dimensions <code>MAX_REFERENCE_LENGTH × N_LAYERS</code> and <code>MAX_QUERY_LENGTH × N_LAYERS</code>, respectively. The users should only specify the values of these arrays, as the DP-HLS’s back-end automatically copies them to the device at runtime.</p>
<p>The following example illustrates the row and column initialization of Global Linear Kernel. It has a single scoring layer at index 0 whose first row and column are initialized to account for gaps at the start of the alignment.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-14-1" name="__codelineno-14-1" href="#__codelineno-14-1"></a><span class="n">type_t</span><span class="w"> </span><span class="n">gap</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">scoring_params</span><span class="p">.</span><span class="n">linear_gap</span><span class="w"> </span><span class="p">;</span>
<a id="__codelineno-14-2" name="__codelineno-14-2" href="#__codelineno-14-2"></a><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">MAX_REFERENCE_LENGTH</span><span class="w"> </span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-14-3" name="__codelineno-14-3" href="#__codelineno-14-3"></a><span class="w">    </span><span class="n">init_row_scr</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">gap</span><span class="w"> </span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<a id="__codelineno-14-4" name="__codelineno-14-4" href="#__codelineno-14-4"></a><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">MAX_QUERY_LENGTH</span><span class="w"> </span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-14-5" name="__codelineno-14-5" href="#__codelineno-14-5"></a><span class="w">    </span><span class="n">init_col_scr</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">gap</span><span class="w"> </span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
</code></pre></div>
<h3 id="step-4-specify-scoring-function">Step 4: Specify Scoring function</h3>
<p>The second step after initialization is the scoring of the DP matrix. To execute this step, user needs to provide their own recurrence equations to be executed by each Processing Elements (PE) and filled up in each of the cells of the DP matrix. </p>
<p>Specify the recurrence equations for computing the score
and traceback pointer for a single cell (i, j), located at row
<code>i</code> and column <code>j</code> of the DP matrix, in a specific function, <code>PE_func</code>. </p>
<p>The following example code shows the scoring equations computed by PEs for the Local Linear kernel. The arrays <code>dp_mem_up</code>, <code>dp_mem_diag</code>, and <code>dp_mem_left</code>, are the inputs to <code>PE_func</code> and populated with cell scores automatically by the DP-HLS backend for cells at positions up (i-1, j), diagonal (i-1, j-1) and left (i, j-1) of the current cell (i, j). Likewise, the i<sup>th</sup> query character and the j<sup>th</sup> reference character are also automatically available to the input of <code>PE_func</code> as <code>lc_qry_val</code> and <code>lc_ref_val</code>, respectively. At the end of the function call, valid scores and traceback pointers for cell (i, j) must be stored to <code>wt_scr</code> and <code>wt_tbp</code>.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-15-1" name="__codelineno-15-1" href="#__codelineno-15-1"></a><span class="c1">// Inside Local Linear PE_func</span>
<a id="__codelineno-15-2" name="__codelineno-15-2" href="#__codelineno-15-2"></a><span class="c1">// Compute the upper , left , and diagonal scores</span>
<a id="__codelineno-15-3" name="__codelineno-15-3" href="#__codelineno-15-3"></a>
<a id="__codelineno-15-4" name="__codelineno-15-4" href="#__codelineno-15-4"></a><span class="n">type_t</span><span class="w"> </span><span class="n">linear_gap</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">params</span><span class="w"> </span><span class="p">.</span><span class="w"> </span><span class="n">linear_gap</span><span class="w"> </span><span class="p">;</span>
<a id="__codelineno-15-5" name="__codelineno-15-5" href="#__codelineno-15-5"></a><span class="n">type_t</span><span class="w"> </span><span class="n">ins</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">dp_mem_left</span><span class="w"> </span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">linear_gap</span><span class="w"> </span><span class="p">;</span>
<a id="__codelineno-15-6" name="__codelineno-15-6" href="#__codelineno-15-6"></a><span class="n">type_t</span><span class="w"> </span><span class="n">del</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">dp_mem_up</span><span class="w"> </span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">linear_gap</span><span class="w"> </span><span class="p">;</span>
<a id="__codelineno-15-7" name="__codelineno-15-7" href="#__codelineno-15-7"></a><span class="n">type_t</span><span class="w"> </span><span class="n">match</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">dp_mem_diag</span><span class="w"> </span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">lc_qry_val</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">lc_ref_val</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="n">params</span><span class="w"> </span><span class="p">.</span><span class="w"> </span><span class="n">match</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">params</span><span class="w"> </span><span class="p">.</span><span class="w"> </span><span class="n">mismatch</span><span class="w"> </span><span class="p">;</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><a id="__codelineno-16-1" name="__codelineno-16-1" href="#__codelineno-16-1"></a><span class="c1">// determine the maximum value and traceback</span>
<a id="__codelineno-16-2" name="__codelineno-16-2" href="#__codelineno-16-2"></a>
<a id="__codelineno-16-3" name="__codelineno-16-3" href="#__codelineno-16-3"></a><span class="n">type_t</span><span class="w"> </span><span class="n">max_value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ins</span><span class="w"> </span><span class="p">;</span>
<a id="__codelineno-16-4" name="__codelineno-16-4" href="#__codelineno-16-4"></a><span class="n">wt_tbp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">TB_LEFT</span><span class="w"> </span><span class="p">;</span>
<a id="__codelineno-16-5" name="__codelineno-16-5" href="#__codelineno-16-5"></a>
<a id="__codelineno-16-6" name="__codelineno-16-6" href="#__codelineno-16-6"></a><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">max_value</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">match</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">max_value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">match</span><span class="w"> </span><span class="p">;</span>
<a id="__codelineno-16-7" name="__codelineno-16-7" href="#__codelineno-16-7"></a><span class="w">    </span><span class="n">wt_tbp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">TB_DIAG</span><span class="w"> </span><span class="p">;</span><span class="w"> </span>
<a id="__codelineno-16-8" name="__codelineno-16-8" href="#__codelineno-16-8"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-16-9" name="__codelineno-16-9" href="#__codelineno-16-9"></a><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">max_value</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">del</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">max_value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">del</span><span class="w"> </span><span class="p">;</span>
<a id="__codelineno-16-10" name="__codelineno-16-10" href="#__codelineno-16-10"></a><span class="w">    </span><span class="n">wt_tbp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">TB_UP</span><span class="w"> </span><span class="p">;</span><span class="w"> </span>
<a id="__codelineno-16-11" name="__codelineno-16-11" href="#__codelineno-16-11"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-16-12" name="__codelineno-16-12" href="#__codelineno-16-12"></a><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">max_value</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">type_t</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">max_value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<a id="__codelineno-16-13" name="__codelineno-16-13" href="#__codelineno-16-13"></a><span class="w">    </span><span class="n">wt_tbp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">TB_END</span><span class="w"> </span><span class="p">;</span><span class="w"> </span>
<a id="__codelineno-16-14" name="__codelineno-16-14" href="#__codelineno-16-14"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-16-15" name="__codelineno-16-15" href="#__codelineno-16-15"></a>
<a id="__codelineno-16-16" name="__codelineno-16-16" href="#__codelineno-16-16"></a><span class="n">wt_scr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">max_value</span><span class="w"> </span><span class="p">;</span>
</code></pre></div>
<h3 id="step-5-specify-traceback-strategy">Step 5: Specify Traceback Strategy</h3>
<p>The third step after initialization and scoring logic modification of your own custom kernel is to specify the traceback logic/strategy.</p>
<p>Each score matrix cell is mapped to a state, and state transitions correspond to jumps between scoring matrices. User needs to define the logic to map the current cell’s state and its traceback pointer to the next cell which is called at every traceback step. </p>
<p>In the Local Linear kernel example with a single state shown below, the outer if-statement checks the current state from the <code>tb_state</code> and assigns the new state. The traceback write-out port <code>wt_tbp</code> is assigned a direction to move in the score matrix, corresponding to insertion, deletion, match/mismatch, or end of the traceback.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-17-1" name="__codelineno-17-1" href="#__codelineno-17-1"></a><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">tb_state</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">TB_STATE</span><span class="w"> </span><span class="o">::</span><span class="w"> </span><span class="n">MM</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-17-2" name="__codelineno-17-2" href="#__codelineno-17-2"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">tb_ptr</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">TB_DIAG</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">tb_move</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">AL_MMI</span><span class="w"> </span><span class="p">;</span><span class="w"> </span>
<a id="__codelineno-17-3" name="__codelineno-17-3" href="#__codelineno-17-3"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-17-4" name="__codelineno-17-4" href="#__codelineno-17-4"></a><span class="w">    </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">tb_ptr</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">TB_UP</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">tb_move</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">AL_DEL</span><span class="w"> </span><span class="p">;</span><span class="w"> </span>
<a id="__codelineno-17-5" name="__codelineno-17-5" href="#__codelineno-17-5"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-17-6" name="__codelineno-17-6" href="#__codelineno-17-6"></a><span class="w">    </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">tb_ptr</span><span class="w">    </span><span class="o">==</span><span class="w"> </span><span class="n">TB_LEFT</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">tb_move</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">AL_INS</span><span class="w"> </span><span class="p">;</span>
<a id="__codelineno-17-7" name="__codelineno-17-7" href="#__codelineno-17-7"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-17-8" name="__codelineno-17-8" href="#__codelineno-17-8"></a><span class="w">    </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">tb_ptr</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">TB_END</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">tb_move</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">AL_END</span><span class="w"> </span><span class="p">;</span>
<a id="__codelineno-17-9" name="__codelineno-17-9" href="#__codelineno-17-9"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-17-10" name="__codelineno-17-10" href="#__codelineno-17-10"></a><span class="w">    </span><span class="k">else</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">tb_move</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">AL_END</span><span class="w"> </span><span class="p">;</span><span class="w"> </span>
<a id="__codelineno-17-11" name="__codelineno-17-11" href="#__codelineno-17-11"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-17-12" name="__codelineno-17-12" href="#__codelineno-17-12"></a>
<a id="__codelineno-17-13" name="__codelineno-17-13" href="#__codelineno-17-13"></a><span class="n">tb_state</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">TB_STATE</span><span class="w"> </span><span class="o">::</span><span class="w"> </span><span class="n">MM</span><span class="w"> </span><span class="p">;</span>
<a id="__codelineno-17-14" name="__codelineno-17-14" href="#__codelineno-17-14"></a><span class="p">}</span>
</code></pre></div>
<h3 id="step-6-specify-parallelism">Step 6: Specify Parallelism</h3>
<p>Each kernel in DP-HLS consists of N<sub>B</sub> blocks, which concurrently execute distinct pairs of input sequences, each having N<sub>PE</sub> number of PEs. These blocks are identical in terms of hardware implementation, ensuring uniform performance across all blocks. To exploit the resources for maximum throughput, DP-HLS allows multiple blocks to be executed in single hardware device. DP-HLS also allows user to integrate and execute different types of kernels (N<sub>K</sub> number of heterogenous kernels), each having N<sub>B</sub> parallel blocks. </p>
<p>The parameter N<sub>PE</sub> determines the level of inner-loop parallelism for a single pair of sequences. DP-HLS exploits outer-loop parallelism across multiple sequence pairs by setting the parameters N<sub>B</sub> and N<sub>K</sub>.</p>
<p>The values of N<sub>PE</sub>, N<sub>B</sub> and N<sub>K</sub> are all customizable by the users. </p>
<h2 id="build-and-simulate-new-kernels">Build and simulate new kernels</h2>
<p>Once the kernels are customized based on your own specific requirement, then its time to build and simulate it to verify the changes. The C-Simulation or C based simulation of the customized kernel is performed with CMake, since it enables standard C++ debugging processes and the debuggers. </p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Vitis HLS also supports the C-Simulation step which uses <code>v++</code> compiler. However, we found the standard <code>c++</code> compiler to have much smaller latency in rebuilding the kernel and rerun the debugger than using the Vitis HLS.</p>
</div>
<h3 id="step-1-install-dependencies">Step 1: Install Dependencies</h3>
<p>To build and simulate the kernel, it is required to have <code>g++ (GCC) &gt;= 4.8.5</code> and <code>CMake3</code> installed in your system. </p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>If you have older version of CMake in your system, you need to install CMake3 and set it to default instead. You could follow this useful <a href="https://stackoverflow.com/questions/48831131/cmake-on-linux-centos-7-how-to-force-the-system-to-use-cmake3">StackOverflow post</a> to perform this step.</p>
</div>
<h3 id="step-2-create-a-testbench">Step 2: Create a testbench</h3>
<p>For the basic C based simulation of the customized kernel, user needs to create a simple testbench to drive the kernel at this step. A testbench should consists of the buffer and input initialization, kernel call, and output verification. Please refer to the following code for the testbench example of Global Affine kernel. Notice that you can write a similar C++ function to verify the correctness of the kernel output. </p>
<style>
.scrollable-code {
    max-height: 300px; /* Adjust the height as needed */
    overflow-y: auto;
}
</style>

<div class="scrollable-code">

<div class="highlight"><pre><span></span><code><a id="__codelineno-18-1" name="__codelineno-18-1" href="#__codelineno-18-1"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;string&gt;</span>
<a id="__codelineno-18-2" name="__codelineno-18-2" href="#__codelineno-18-2"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;vector&gt;</span>
<a id="__codelineno-18-3" name="__codelineno-18-3" href="#__codelineno-18-3"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;array&gt;</span>
<a id="__codelineno-18-4" name="__codelineno-18-4" href="#__codelineno-18-4"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;map&gt;</span>
<a id="__codelineno-18-5" name="__codelineno-18-5" href="#__codelineno-18-5"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;chrono&gt;</span>
<a id="__codelineno-18-6" name="__codelineno-18-6" href="#__codelineno-18-6"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;params.h&quot;</span>
<a id="__codelineno-18-7" name="__codelineno-18-7" href="#__codelineno-18-7"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;seq_align_multiple.h&quot;</span>
<a id="__codelineno-18-8" name="__codelineno-18-8" href="#__codelineno-18-8"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;host_utils.h&quot;</span>
<a id="__codelineno-18-9" name="__codelineno-18-9" href="#__codelineno-18-9"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;solutions.h&quot;</span>
<a id="__codelineno-18-10" name="__codelineno-18-10" href="#__codelineno-18-10"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;debug.h&quot;</span>
<a id="__codelineno-18-11" name="__codelineno-18-11" href="#__codelineno-18-11"></a>
<a id="__codelineno-18-12" name="__codelineno-18-12" href="#__codelineno-18-12"></a><span class="k">using</span><span class="w"> </span><span class="k">namespace</span><span class="w"> </span><span class="nn">std</span><span class="p">;</span>
<a id="__codelineno-18-13" name="__codelineno-18-13" href="#__codelineno-18-13"></a>
<a id="__codelineno-18-14" name="__codelineno-18-14" href="#__codelineno-18-14"></a><span class="cp">#define INPUT_QUERY_LENGTH 256</span>
<a id="__codelineno-18-15" name="__codelineno-18-15" href="#__codelineno-18-15"></a><span class="cp">#define INPUT_REFERENCE_LENGTH 256</span>
<a id="__codelineno-18-16" name="__codelineno-18-16" href="#__codelineno-18-16"></a>
<a id="__codelineno-18-17" name="__codelineno-18-17" href="#__codelineno-18-17"></a><span class="n">char_t</span><span class="w"> </span><span class="nf">base_to_num</span><span class="p">(</span><span class="kt">char</span><span class="w"> </span><span class="n">base</span><span class="p">)</span>
<a id="__codelineno-18-18" name="__codelineno-18-18" href="#__codelineno-18-18"></a><span class="p">{</span>
<a id="__codelineno-18-19" name="__codelineno-18-19" href="#__codelineno-18-19"></a><span class="w">    </span><span class="k">switch</span><span class="w"> </span><span class="p">(</span><span class="n">base</span><span class="p">)</span>
<a id="__codelineno-18-20" name="__codelineno-18-20" href="#__codelineno-18-20"></a><span class="w">    </span><span class="p">{</span>
<a id="__codelineno-18-21" name="__codelineno-18-21" href="#__codelineno-18-21"></a><span class="w">    </span><span class="k">case</span><span class="w"> </span><span class="sc">&#39;A&#39;</span><span class="p">:</span>
<a id="__codelineno-18-22" name="__codelineno-18-22" href="#__codelineno-18-22"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<a id="__codelineno-18-23" name="__codelineno-18-23" href="#__codelineno-18-23"></a><span class="w">    </span><span class="k">case</span><span class="w"> </span><span class="sc">&#39;C&#39;</span><span class="p">:</span>
<a id="__codelineno-18-24" name="__codelineno-18-24" href="#__codelineno-18-24"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
<a id="__codelineno-18-25" name="__codelineno-18-25" href="#__codelineno-18-25"></a><span class="w">    </span><span class="k">case</span><span class="w"> </span><span class="sc">&#39;G&#39;</span><span class="p">:</span>
<a id="__codelineno-18-26" name="__codelineno-18-26" href="#__codelineno-18-26"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="mi">2</span><span class="p">;</span>
<a id="__codelineno-18-27" name="__codelineno-18-27" href="#__codelineno-18-27"></a><span class="w">    </span><span class="k">case</span><span class="w"> </span><span class="sc">&#39;T&#39;</span><span class="p">:</span>
<a id="__codelineno-18-28" name="__codelineno-18-28" href="#__codelineno-18-28"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="mi">3</span><span class="p">;</span>
<a id="__codelineno-18-29" name="__codelineno-18-29" href="#__codelineno-18-29"></a><span class="w">    </span><span class="k">default</span><span class="o">:</span>
<a id="__codelineno-18-30" name="__codelineno-18-30" href="#__codelineno-18-30"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<a id="__codelineno-18-31" name="__codelineno-18-31" href="#__codelineno-18-31"></a><span class="cp">#ifdef CMAKEDEBUG</span>
<a id="__codelineno-18-32" name="__codelineno-18-32" href="#__codelineno-18-32"></a><span class="w">        </span><span class="k">throw</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">runtime_error</span><span class="p">(</span><span class="s">&quot;Unrecognized Nucleotide &quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">base</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">&quot; from A, C, G, and T.</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span><span class="w"> </span><span class="c1">// or throw an exception</span>
<a id="__codelineno-18-33" name="__codelineno-18-33" href="#__codelineno-18-33"></a><span class="cp">#endif</span>
<a id="__codelineno-18-34" name="__codelineno-18-34" href="#__codelineno-18-34"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-18-35" name="__codelineno-18-35" href="#__codelineno-18-35"></a>
<a id="__codelineno-18-36" name="__codelineno-18-36" href="#__codelineno-18-36"></a><span class="p">}</span>
<a id="__codelineno-18-37" name="__codelineno-18-37" href="#__codelineno-18-37"></a>
<a id="__codelineno-18-38" name="__codelineno-18-38" href="#__codelineno-18-38"></a><span class="k">struct</span><span class="w"> </span><span class="nc">Penalties_sol</span>
<a id="__codelineno-18-39" name="__codelineno-18-39" href="#__codelineno-18-39"></a><span class="p">{</span>
<a id="__codelineno-18-40" name="__codelineno-18-40" href="#__codelineno-18-40"></a><span class="w">    </span><span class="kt">float</span><span class="w"> </span><span class="n">extend</span><span class="p">;</span>
<a id="__codelineno-18-41" name="__codelineno-18-41" href="#__codelineno-18-41"></a><span class="w">    </span><span class="kt">float</span><span class="w"> </span><span class="n">open</span><span class="p">;</span>
<a id="__codelineno-18-42" name="__codelineno-18-42" href="#__codelineno-18-42"></a><span class="w">    </span><span class="kt">float</span><span class="w"> </span><span class="n">linear_gap</span><span class="p">;</span>
<a id="__codelineno-18-43" name="__codelineno-18-43" href="#__codelineno-18-43"></a><span class="w">    </span><span class="kt">float</span><span class="w"> </span><span class="n">match</span><span class="p">;</span>
<a id="__codelineno-18-44" name="__codelineno-18-44" href="#__codelineno-18-44"></a><span class="w">    </span><span class="kt">float</span><span class="w"> </span><span class="n">mismatch</span><span class="p">;</span>
<a id="__codelineno-18-45" name="__codelineno-18-45" href="#__codelineno-18-45"></a><span class="p">};</span>
<a id="__codelineno-18-46" name="__codelineno-18-46" href="#__codelineno-18-46"></a>
<a id="__codelineno-18-47" name="__codelineno-18-47" href="#__codelineno-18-47"></a><span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">(){</span>
<a id="__codelineno-18-48" name="__codelineno-18-48" href="#__codelineno-18-48"></a><span class="w">    </span><span class="kt">char</span><span class="w"> </span><span class="n">alphabet</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="sc">&#39;A&#39;</span><span class="p">,</span><span class="w"> </span><span class="sc">&#39;T&#39;</span><span class="p">,</span><span class="w"> </span><span class="sc">&#39;G&#39;</span><span class="p">,</span><span class="w"> </span><span class="sc">&#39;C&#39;</span><span class="p">};</span>
<a id="__codelineno-18-49" name="__codelineno-18-49" href="#__codelineno-18-49"></a><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="n">query_string</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Random</span><span class="o">::</span><span class="n">Sequence</span><span class="o">&lt;</span><span class="mi">4</span><span class="o">&gt;</span><span class="p">(</span><span class="n">alphabet</span><span class="p">,</span><span class="w"> </span><span class="n">INPUT_QUERY_LENGTH</span><span class="p">);</span>
<a id="__codelineno-18-50" name="__codelineno-18-50" href="#__codelineno-18-50"></a><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="n">reference_string</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Random</span><span class="o">::</span><span class="n">Sequence</span><span class="o">&lt;</span><span class="mi">4</span><span class="o">&gt;</span><span class="p">(</span><span class="n">alphabet</span><span class="p">,</span><span class="w"> </span><span class="n">INPUT_REFERENCE_LENGTH</span><span class="p">);</span>
<a id="__codelineno-18-51" name="__codelineno-18-51" href="#__codelineno-18-51"></a>
<a id="__codelineno-18-52" name="__codelineno-18-52" href="#__codelineno-18-52"></a><span class="w">    </span><span class="c1">// Struct for Penalties in kernel</span>
<a id="__codelineno-18-53" name="__codelineno-18-53" href="#__codelineno-18-53"></a><span class="w">    </span><span class="n">Penalties</span><span class="w"> </span><span class="n">penalties</span><span class="p">[</span><span class="n">N_BLOCKS</span><span class="p">];</span>
<a id="__codelineno-18-54" name="__codelineno-18-54" href="#__codelineno-18-54"></a><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">N_BLOCKS</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">){</span>
<a id="__codelineno-18-55" name="__codelineno-18-55" href="#__codelineno-18-55"></a><span class="w">        </span><span class="n">penalties</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">extend</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">-1</span><span class="p">;</span>
<a id="__codelineno-18-56" name="__codelineno-18-56" href="#__codelineno-18-56"></a><span class="w">        </span><span class="n">penalties</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">open</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">-1</span><span class="p">;</span>
<a id="__codelineno-18-57" name="__codelineno-18-57" href="#__codelineno-18-57"></a><span class="w">        </span><span class="n">penalties</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">match</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">3</span><span class="p">;</span>
<a id="__codelineno-18-58" name="__codelineno-18-58" href="#__codelineno-18-58"></a><span class="w">        </span><span class="n">penalties</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">mismatch</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">-1</span><span class="p">;</span>
<a id="__codelineno-18-59" name="__codelineno-18-59" href="#__codelineno-18-59"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-18-60" name="__codelineno-18-60" href="#__codelineno-18-60"></a>
<a id="__codelineno-18-61" name="__codelineno-18-61" href="#__codelineno-18-61"></a><span class="w">    </span><span class="c1">// Struct for penalties in solution</span>
<a id="__codelineno-18-62" name="__codelineno-18-62" href="#__codelineno-18-62"></a><span class="w">    </span><span class="n">Penalties_sol</span><span class="w"> </span><span class="n">penalties_sol</span><span class="p">[</span><span class="n">N_BLOCKS</span><span class="p">];</span>
<a id="__codelineno-18-63" name="__codelineno-18-63" href="#__codelineno-18-63"></a><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">Penalties_sol</span><span class="w"> </span><span class="o">&amp;</span><span class="n">penalty</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">penalties_sol</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-18-64" name="__codelineno-18-64" href="#__codelineno-18-64"></a><span class="w">        </span><span class="n">penalty</span><span class="p">.</span><span class="n">extend</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">-1</span><span class="p">;</span>
<a id="__codelineno-18-65" name="__codelineno-18-65" href="#__codelineno-18-65"></a><span class="w">        </span><span class="n">penalty</span><span class="p">.</span><span class="n">open</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">-1</span><span class="p">;</span>
<a id="__codelineno-18-66" name="__codelineno-18-66" href="#__codelineno-18-66"></a><span class="w">        </span><span class="n">penalty</span><span class="p">.</span><span class="n">match</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">3</span><span class="p">;</span>
<a id="__codelineno-18-67" name="__codelineno-18-67" href="#__codelineno-18-67"></a><span class="w">        </span><span class="n">penalty</span><span class="p">.</span><span class="n">mismatch</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">-1</span><span class="p">;</span>
<a id="__codelineno-18-68" name="__codelineno-18-68" href="#__codelineno-18-68"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-18-69" name="__codelineno-18-69" href="#__codelineno-18-69"></a>
<a id="__codelineno-18-70" name="__codelineno-18-70" href="#__codelineno-18-70"></a><span class="w">    </span><span class="c1">// Reference and Query Strings</span>
<a id="__codelineno-18-71" name="__codelineno-18-71" href="#__codelineno-18-71"></a><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">char</span><span class="o">&gt;</span><span class="w"> </span><span class="n">query</span><span class="p">(</span><span class="n">query_string</span><span class="p">.</span><span class="n">begin</span><span class="p">(),</span><span class="w"> </span><span class="n">query_string</span><span class="p">.</span><span class="n">end</span><span class="p">());</span>
<a id="__codelineno-18-72" name="__codelineno-18-72" href="#__codelineno-18-72"></a><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">char</span><span class="o">&gt;</span><span class="w"> </span><span class="n">reference</span><span class="p">(</span><span class="n">reference_string</span><span class="p">.</span><span class="n">begin</span><span class="p">(),</span><span class="w"> </span><span class="n">reference_string</span><span class="p">.</span><span class="n">end</span><span class="p">());</span>
<a id="__codelineno-18-73" name="__codelineno-18-73" href="#__codelineno-18-73"></a>
<a id="__codelineno-18-74" name="__codelineno-18-74" href="#__codelineno-18-74"></a><span class="cp">#ifdef CMAKEDEBUG</span>
<a id="__codelineno-18-75" name="__codelineno-18-75" href="#__codelineno-18-75"></a><span class="w">    </span><span class="c1">// Initialize Debugger</span>
<a id="__codelineno-18-76" name="__codelineno-18-76" href="#__codelineno-18-76"></a><span class="w">    </span><span class="n">Container</span><span class="w"> </span><span class="n">debuggers</span><span class="p">[</span><span class="n">N_BLOCKS</span><span class="p">];</span>
<a id="__codelineno-18-77" name="__codelineno-18-77" href="#__codelineno-18-77"></a><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">N_BLOCKS</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">){</span>
<a id="__codelineno-18-78" name="__codelineno-18-78" href="#__codelineno-18-78"></a><span class="w">        </span><span class="n">debuggers</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Container</span><span class="p">();</span>
<a id="__codelineno-18-79" name="__codelineno-18-79" href="#__codelineno-18-79"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-18-80" name="__codelineno-18-80" href="#__codelineno-18-80"></a><span class="cp">#endif</span>
<a id="__codelineno-18-81" name="__codelineno-18-81" href="#__codelineno-18-81"></a>
<a id="__codelineno-18-82" name="__codelineno-18-82" href="#__codelineno-18-82"></a><span class="w">    </span><span class="c1">// Assert actual query length and reference length should be smaller than the maximum length</span>
<a id="__codelineno-18-83" name="__codelineno-18-83" href="#__codelineno-18-83"></a><span class="w">    </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-18-84" name="__codelineno-18-84" href="#__codelineno-18-84"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">query</span><span class="p">.</span><span class="n">size</span><span class="p">()</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">MAX_QUERY_LENGTH</span><span class="p">)</span><span class="w"> </span><span class="k">throw</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">runtime_error</span><span class="p">(</span><span class="s">&quot;Query length should less than MAX_QUERY_LENGTH, &quot;</span>
<a id="__codelineno-18-85" name="__codelineno-18-85" href="#__codelineno-18-85"></a><span class="w">            </span><span class="s">&quot;actual query len &quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">to_string</span><span class="p">(</span><span class="n">query</span><span class="p">.</span><span class="n">size</span><span class="p">())</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">&quot;, Allocated qry len: &quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">to_string</span><span class="p">(</span><span class="n">MAX_QUERY_LENGTH</span><span class="p">));</span>
<a id="__codelineno-18-86" name="__codelineno-18-86" href="#__codelineno-18-86"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">reference</span><span class="p">.</span><span class="n">size</span><span class="p">()</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">MAX_REFERENCE_LENGTH</span><span class="p">)</span><span class="w"> </span><span class="k">throw</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">runtime_error</span><span class="p">(</span><span class="s">&quot;Reference length should less than MAX_REFERENCE_LENGTH, &quot;</span>
<a id="__codelineno-18-87" name="__codelineno-18-87" href="#__codelineno-18-87"></a><span class="w">            </span><span class="s">&quot;actual ref len &quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">to_string</span><span class="p">(</span><span class="n">reference</span><span class="p">.</span><span class="n">size</span><span class="p">())</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">&quot;, Allocated ref len: &quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">to_string</span><span class="p">(</span><span class="n">MAX_REFERENCE_LENGTH</span><span class="p">));</span>
<a id="__codelineno-18-88" name="__codelineno-18-88" href="#__codelineno-18-88"></a><span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">exception</span><span class="w"> </span><span class="o">&amp;</span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-18-89" name="__codelineno-18-89" href="#__codelineno-18-89"></a><span class="w">        </span><span class="n">std</span><span class="o">::</span><span class="n">cerr</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;Exception: &quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">e</span><span class="p">.</span><span class="n">what</span><span class="p">()</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
<a id="__codelineno-18-90" name="__codelineno-18-90" href="#__codelineno-18-90"></a><span class="w">        </span><span class="k">throw</span><span class="p">;</span>
<a id="__codelineno-18-91" name="__codelineno-18-91" href="#__codelineno-18-91"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-18-92" name="__codelineno-18-92" href="#__codelineno-18-92"></a>
<a id="__codelineno-18-93" name="__codelineno-18-93" href="#__codelineno-18-93"></a><span class="w">    </span><span class="c1">// Allocate query and reference buffer to pass to the kernel</span>
<a id="__codelineno-18-94" name="__codelineno-18-94" href="#__codelineno-18-94"></a><span class="w">    </span><span class="n">char_t</span><span class="w"> </span><span class="n">reference_buff</span><span class="p">[</span><span class="n">MAX_REFERENCE_LENGTH</span><span class="p">][</span><span class="n">N_BLOCKS</span><span class="p">];</span>
<a id="__codelineno-18-95" name="__codelineno-18-95" href="#__codelineno-18-95"></a><span class="w">    </span><span class="n">char_t</span><span class="w"> </span><span class="n">query_buff</span><span class="p">[</span><span class="n">MAX_QUERY_LENGTH</span><span class="p">][</span><span class="n">N_BLOCKS</span><span class="p">];</span>
<a id="__codelineno-18-96" name="__codelineno-18-96" href="#__codelineno-18-96"></a>
<a id="__codelineno-18-97" name="__codelineno-18-97" href="#__codelineno-18-97"></a><span class="w">    </span><span class="c1">// Allocate lengths for query and reference</span>
<a id="__codelineno-18-98" name="__codelineno-18-98" href="#__codelineno-18-98"></a><span class="w">    </span><span class="n">idx_t</span><span class="w"> </span><span class="n">qry_lengths</span><span class="p">[</span><span class="n">N_BLOCKS</span><span class="p">],</span><span class="w"> </span><span class="n">ref_lengths</span><span class="p">[</span><span class="n">N_BLOCKS</span><span class="p">];</span>
<a id="__codelineno-18-99" name="__codelineno-18-99" href="#__codelineno-18-99"></a>
<a id="__codelineno-18-100" name="__codelineno-18-100" href="#__codelineno-18-100"></a><span class="w">    </span><span class="c1">// Fill query buffer and references buffer for all blocks.</span>
<a id="__codelineno-18-101" name="__codelineno-18-101" href="#__codelineno-18-101"></a><span class="w">    </span><span class="c1">// Each buffer is of MAX size, but only the actual length</span>
<a id="__codelineno-18-102" name="__codelineno-18-102" href="#__codelineno-18-102"></a><span class="w">    </span><span class="c1">// elements is filled.</span>
<a id="__codelineno-18-103" name="__codelineno-18-103" href="#__codelineno-18-103"></a><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">b</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">b</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">N_BLOCKS</span><span class="p">;</span><span class="w"> </span><span class="n">b</span><span class="o">++</span><span class="p">)</span>
<a id="__codelineno-18-104" name="__codelineno-18-104" href="#__codelineno-18-104"></a><span class="w">    </span><span class="p">{</span>
<a id="__codelineno-18-105" name="__codelineno-18-105" href="#__codelineno-18-105"></a><span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">query</span><span class="p">.</span><span class="n">size</span><span class="p">();</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span>
<a id="__codelineno-18-106" name="__codelineno-18-106" href="#__codelineno-18-106"></a><span class="w">        </span><span class="p">{</span>
<a id="__codelineno-18-107" name="__codelineno-18-107" href="#__codelineno-18-107"></a><span class="w">            </span><span class="n">query_buff</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">b</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">base_to_num</span><span class="p">(</span><span class="n">query</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>
<a id="__codelineno-18-108" name="__codelineno-18-108" href="#__codelineno-18-108"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-18-109" name="__codelineno-18-109" href="#__codelineno-18-109"></a><span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">reference</span><span class="p">.</span><span class="n">size</span><span class="p">();</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span>
<a id="__codelineno-18-110" name="__codelineno-18-110" href="#__codelineno-18-110"></a><span class="w">        </span><span class="p">{</span>
<a id="__codelineno-18-111" name="__codelineno-18-111" href="#__codelineno-18-111"></a><span class="w">            </span><span class="n">reference_buff</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">b</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">base_to_num</span><span class="p">(</span><span class="n">reference</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>
<a id="__codelineno-18-112" name="__codelineno-18-112" href="#__codelineno-18-112"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-18-113" name="__codelineno-18-113" href="#__codelineno-18-113"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-18-114" name="__codelineno-18-114" href="#__codelineno-18-114"></a>
<a id="__codelineno-18-115" name="__codelineno-18-115" href="#__codelineno-18-115"></a><span class="w">    </span><span class="c1">// Fill the lengths of the query and reference</span>
<a id="__codelineno-18-116" name="__codelineno-18-116" href="#__codelineno-18-116"></a><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">b</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">b</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">N_BLOCKS</span><span class="p">;</span><span class="w"> </span><span class="n">b</span><span class="o">++</span><span class="p">)</span>
<a id="__codelineno-18-117" name="__codelineno-18-117" href="#__codelineno-18-117"></a><span class="w">    </span><span class="p">{</span>
<a id="__codelineno-18-118" name="__codelineno-18-118" href="#__codelineno-18-118"></a><span class="w">        </span><span class="n">qry_lengths</span><span class="p">[</span><span class="n">b</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">query</span><span class="p">.</span><span class="n">size</span><span class="p">();</span>
<a id="__codelineno-18-119" name="__codelineno-18-119" href="#__codelineno-18-119"></a><span class="w">        </span><span class="n">ref_lengths</span><span class="p">[</span><span class="n">b</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">reference</span><span class="p">.</span><span class="n">size</span><span class="p">();</span>
<a id="__codelineno-18-120" name="__codelineno-18-120" href="#__codelineno-18-120"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-18-121" name="__codelineno-18-121" href="#__codelineno-18-121"></a>
<a id="__codelineno-18-122" name="__codelineno-18-122" href="#__codelineno-18-122"></a><span class="w">    </span><span class="c1">// Allocate traceback streams</span>
<a id="__codelineno-18-123" name="__codelineno-18-123" href="#__codelineno-18-123"></a><span class="w">    </span><span class="n">tbr_t</span><span class="w"> </span><span class="n">tb_streams</span><span class="p">[</span><span class="n">MAX_REFERENCE_LENGTH</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">MAX_QUERY_LENGTH</span><span class="p">][</span><span class="n">N_BLOCKS</span><span class="p">];</span>
<a id="__codelineno-18-124" name="__codelineno-18-124" href="#__codelineno-18-124"></a>
<a id="__codelineno-18-125" name="__codelineno-18-125" href="#__codelineno-18-125"></a><span class="w">    </span><span class="c1">// initialize traceback starting coordinates</span>
<a id="__codelineno-18-126" name="__codelineno-18-126" href="#__codelineno-18-126"></a><span class="w">    </span><span class="n">idx_t</span><span class="w"> </span><span class="n">tb_is</span><span class="p">[</span><span class="n">N_BLOCKS</span><span class="p">];</span>
<a id="__codelineno-18-127" name="__codelineno-18-127" href="#__codelineno-18-127"></a><span class="w">    </span><span class="n">idx_t</span><span class="w"> </span><span class="n">tb_js</span><span class="p">[</span><span class="n">N_BLOCKS</span><span class="p">];</span>
<a id="__codelineno-18-128" name="__codelineno-18-128" href="#__codelineno-18-128"></a>
<a id="__codelineno-18-129" name="__codelineno-18-129" href="#__codelineno-18-129"></a><span class="w">    </span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;Kernel Started&quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">endl</span><span class="p">;</span>
<a id="__codelineno-18-130" name="__codelineno-18-130" href="#__codelineno-18-130"></a><span class="w">    </span><span class="c1">// Actual kernel calling</span>
<a id="__codelineno-18-131" name="__codelineno-18-131" href="#__codelineno-18-131"></a><span class="w">    </span><span class="n">seq_align_multiple_static</span><span class="p">(</span>
<a id="__codelineno-18-132" name="__codelineno-18-132" href="#__codelineno-18-132"></a><span class="w">        </span><span class="n">query_buff</span><span class="p">,</span>
<a id="__codelineno-18-133" name="__codelineno-18-133" href="#__codelineno-18-133"></a><span class="w">        </span><span class="n">reference_buff</span><span class="p">,</span>
<a id="__codelineno-18-134" name="__codelineno-18-134" href="#__codelineno-18-134"></a><span class="w">        </span><span class="n">qry_lengths</span><span class="p">,</span>
<a id="__codelineno-18-135" name="__codelineno-18-135" href="#__codelineno-18-135"></a><span class="w">        </span><span class="n">ref_lengths</span><span class="p">,</span>
<a id="__codelineno-18-136" name="__codelineno-18-136" href="#__codelineno-18-136"></a><span class="w">        </span><span class="n">penalties</span><span class="p">,</span>
<a id="__codelineno-18-137" name="__codelineno-18-137" href="#__codelineno-18-137"></a><span class="w">        </span><span class="n">tb_is</span><span class="p">,</span><span class="w"> </span><span class="n">tb_js</span><span class="p">,</span>
<a id="__codelineno-18-138" name="__codelineno-18-138" href="#__codelineno-18-138"></a><span class="w">        </span><span class="n">tb_streams</span>
<a id="__codelineno-18-139" name="__codelineno-18-139" href="#__codelineno-18-139"></a><span class="cp">#ifdef CMAKEDEBUG</span>
<a id="__codelineno-18-140" name="__codelineno-18-140" href="#__codelineno-18-140"></a><span class="w">        </span><span class="p">,</span><span class="w"> </span><span class="n">debuggers</span>
<a id="__codelineno-18-141" name="__codelineno-18-141" href="#__codelineno-18-141"></a><span class="cp">#endif</span>
<a id="__codelineno-18-142" name="__codelineno-18-142" href="#__codelineno-18-142"></a><span class="w">        </span><span class="p">);</span>
<a id="__codelineno-18-143" name="__codelineno-18-143" href="#__codelineno-18-143"></a>
<a id="__codelineno-18-144" name="__codelineno-18-144" href="#__codelineno-18-144"></a><span class="w">    </span><span class="c1">// Print the query and reference strings</span>
<a id="__codelineno-18-145" name="__codelineno-18-145" href="#__codelineno-18-145"></a><span class="w">    </span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;Query    : &quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">query_string</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">endl</span><span class="p">;</span>
<a id="__codelineno-18-146" name="__codelineno-18-146" href="#__codelineno-18-146"></a><span class="w">    </span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;Reference: &quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">reference_string</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">endl</span><span class="p">;</span>
<a id="__codelineno-18-147" name="__codelineno-18-147" href="#__codelineno-18-147"></a>
<a id="__codelineno-18-148" name="__codelineno-18-148" href="#__codelineno-18-148"></a><span class="w">    </span><span class="c1">// Get the solution scores and traceback</span>
<a id="__codelineno-18-149" name="__codelineno-18-149" href="#__codelineno-18-149"></a><span class="w">    </span><span class="n">array</span><span class="o">&lt;</span><span class="n">array</span><span class="o">&lt;</span><span class="n">array</span><span class="o">&lt;</span><span class="kt">float</span><span class="p">,</span><span class="w"> </span><span class="n">MAX_REFERENCE_LENGTH</span><span class="o">&gt;</span><span class="p">,</span><span class="w"> </span><span class="n">MAX_QUERY_LENGTH</span><span class="o">&gt;</span><span class="p">,</span><span class="w"> </span><span class="n">N_LAYERS</span><span class="o">&gt;</span><span class="w"> </span><span class="n">sol_score_mat</span><span class="p">;</span>
<a id="__codelineno-18-150" name="__codelineno-18-150" href="#__codelineno-18-150"></a><span class="w">    </span><span class="n">array</span><span class="o">&lt;</span><span class="n">array</span><span class="o">&lt;</span><span class="n">string</span><span class="p">,</span><span class="w"> </span><span class="n">MAX_REFERENCE_LENGTH</span><span class="o">&gt;</span><span class="p">,</span><span class="w"> </span><span class="n">MAX_QUERY_LENGTH</span><span class="o">&gt;</span><span class="w"> </span><span class="n">sol_tb_mat</span><span class="p">;</span>
<a id="__codelineno-18-151" name="__codelineno-18-151" href="#__codelineno-18-151"></a><span class="w">    </span><span class="n">map</span><span class="o">&lt;</span><span class="n">string</span><span class="p">,</span><span class="w"> </span><span class="n">string</span><span class="o">&gt;</span><span class="w"> </span><span class="n">alignments</span><span class="p">;</span>
<a id="__codelineno-18-152" name="__codelineno-18-152" href="#__codelineno-18-152"></a><span class="w">    </span><span class="k">auto</span><span class="w"> </span><span class="n">sol_start</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">chrono</span><span class="o">::</span><span class="n">high_resolution_clock</span><span class="o">::</span><span class="n">now</span><span class="p">();</span>
<a id="__codelineno-18-153" name="__codelineno-18-153" href="#__codelineno-18-153"></a><span class="w">    </span><span class="n">global_affine_solution</span><span class="o">&lt;</span><span class="n">Penalties_sol</span><span class="p">,</span><span class="w"> </span><span class="n">MAX_QUERY_LENGTH</span><span class="p">,</span><span class="w"> </span><span class="n">MAX_REFERENCE_LENGTH</span><span class="p">,</span><span class="w"> </span><span class="n">N_LAYERS</span><span class="o">&gt;</span><span class="p">(</span><span class="n">query_string</span><span class="p">,</span><span class="w"> </span><span class="n">reference_string</span><span class="p">,</span><span class="w"> </span><span class="n">penalties_sol</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="w"> </span><span class="n">sol_score_mat</span><span class="p">,</span><span class="w"> </span><span class="n">sol_tb_mat</span><span class="p">,</span><span class="w"> </span><span class="n">alignments</span><span class="p">);</span>
<a id="__codelineno-18-154" name="__codelineno-18-154" href="#__codelineno-18-154"></a><span class="w">    </span><span class="k">auto</span><span class="w"> </span><span class="n">sol_end</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">chrono</span><span class="o">::</span><span class="n">high_resolution_clock</span><span class="o">::</span><span class="n">now</span><span class="p">();</span>
<a id="__codelineno-18-155" name="__codelineno-18-155" href="#__codelineno-18-155"></a><span class="w">    </span><span class="c1">// print_matrix&lt;float, MAX_QUERY_LENGTH, MAX_REFERENCE_LENGTH&gt;(sol_score_mat[0], &quot;Solution Score Matrix Layer 0&quot;);</span>
<a id="__codelineno-18-156" name="__codelineno-18-156" href="#__codelineno-18-156"></a><span class="w">    </span><span class="c1">// print_matrix&lt;char, MAX_QUERY_LENGTH, MAX_REFERENCE_LENGTH&gt;(sol_tb_mat, &quot;Solution Traceback Matrix&quot;);</span>
<a id="__codelineno-18-157" name="__codelineno-18-157" href="#__codelineno-18-157"></a><span class="w">    </span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;Solution Aligned Query    : &quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">alignments</span><span class="p">[</span><span class="s">&quot;query&quot;</span><span class="p">]</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">endl</span><span class="p">;</span>
<a id="__codelineno-18-158" name="__codelineno-18-158" href="#__codelineno-18-158"></a><span class="w">    </span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;Solution Aligned Reference: &quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">alignments</span><span class="p">[</span><span class="s">&quot;reference&quot;</span><span class="p">]</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">endl</span><span class="p">;</span>
<a id="__codelineno-18-159" name="__codelineno-18-159" href="#__codelineno-18-159"></a><span class="w">    </span><span class="c1">// Display solution runtime</span>
<a id="__codelineno-18-160" name="__codelineno-18-160" href="#__codelineno-18-160"></a><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;Solution Runtime: &quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">chrono</span><span class="o">::</span><span class="n">duration_cast</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">chrono</span><span class="o">::</span><span class="n">milliseconds</span><span class="o">&gt;</span><span class="p">(</span><span class="n">sol_end</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">sol_start</span><span class="p">).</span><span class="n">count</span><span class="p">()</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;ms&quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
<a id="__codelineno-18-161" name="__codelineno-18-161" href="#__codelineno-18-161"></a>
<a id="__codelineno-18-162" name="__codelineno-18-162" href="#__codelineno-18-162"></a><span class="cp">#ifdef CMAKEDEBUG</span>
<a id="__codelineno-18-163" name="__codelineno-18-163" href="#__codelineno-18-163"></a><span class="w">    </span><span class="c1">// Cast kernel scores to matrix scores</span>
<a id="__codelineno-18-164" name="__codelineno-18-164" href="#__codelineno-18-164"></a><span class="w">    </span><span class="n">debuggers</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">cast_scores</span><span class="p">();</span>
<a id="__codelineno-18-165" name="__codelineno-18-165" href="#__codelineno-18-165"></a><span class="w">    </span><span class="c1">// print_matrix&lt;float, MAX_QUERY_LENGTH, MAX_REFERENCE_LENGTH&gt;(debuggers[0].scores_cpp[0], &quot;Kernel 0 Scores Layer 0&quot;);</span>
<a id="__codelineno-18-166" name="__codelineno-18-166" href="#__codelineno-18-166"></a><span class="w">    </span><span class="n">debuggers</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">compare_scores</span><span class="p">(</span><span class="n">sol_score_mat</span><span class="p">,</span><span class="w"> </span><span class="n">query</span><span class="p">.</span><span class="n">size</span><span class="p">(),</span><span class="w"> </span><span class="n">reference</span><span class="p">.</span><span class="n">size</span><span class="p">());</span><span class="w">  </span><span class="c1">// check if the scores from the kernel matches scores from the solution</span>
<a id="__codelineno-18-167" name="__codelineno-18-167" href="#__codelineno-18-167"></a><span class="cp">#endif</span>
<a id="__codelineno-18-168" name="__codelineno-18-168" href="#__codelineno-18-168"></a>
<a id="__codelineno-18-169" name="__codelineno-18-169" href="#__codelineno-18-169"></a><span class="w">    </span><span class="c1">// reconstruct kernel alignments</span>
<a id="__codelineno-18-170" name="__codelineno-18-170" href="#__codelineno-18-170"></a><span class="w">    </span><span class="n">array</span><span class="o">&lt;</span><span class="n">map</span><span class="o">&lt;</span><span class="n">string</span><span class="p">,</span><span class="w"> </span><span class="n">string</span><span class="o">&gt;</span><span class="p">,</span><span class="w"> </span><span class="n">N_BLOCKS</span><span class="o">&gt;</span><span class="w"> </span><span class="n">kernel_alignments</span><span class="p">;</span>
<a id="__codelineno-18-171" name="__codelineno-18-171" href="#__codelineno-18-171"></a><span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">tb_query_lengths</span><span class="p">[</span><span class="n">N_BLOCKS</span><span class="p">];</span>
<a id="__codelineno-18-172" name="__codelineno-18-172" href="#__codelineno-18-172"></a><span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">tb_reference_lengths</span><span class="p">[</span><span class="n">N_BLOCKS</span><span class="p">];</span>
<a id="__codelineno-18-173" name="__codelineno-18-173" href="#__codelineno-18-173"></a><span class="w">    </span><span class="n">string</span><span class="w"> </span><span class="n">query_string_blocks</span><span class="p">[</span><span class="n">N_BLOCKS</span><span class="p">];</span>
<a id="__codelineno-18-174" name="__codelineno-18-174" href="#__codelineno-18-174"></a><span class="w">    </span><span class="n">string</span><span class="w"> </span><span class="n">reference_string_blocks</span><span class="p">[</span><span class="n">N_BLOCKS</span><span class="p">];</span>
<a id="__codelineno-18-175" name="__codelineno-18-175" href="#__codelineno-18-175"></a><span class="w">    </span><span class="c1">// for global alignments, adjust the lengths to be the lengths - 1</span>
<a id="__codelineno-18-176" name="__codelineno-18-176" href="#__codelineno-18-176"></a><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">N_BLOCKS</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-18-177" name="__codelineno-18-177" href="#__codelineno-18-177"></a><span class="w">        </span><span class="n">tb_query_lengths</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="p">)</span><span class="w"> </span><span class="n">tb_is</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
<a id="__codelineno-18-178" name="__codelineno-18-178" href="#__codelineno-18-178"></a><span class="w">        </span><span class="n">tb_reference_lengths</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="p">)</span><span class="w"> </span><span class="n">tb_js</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
<a id="__codelineno-18-179" name="__codelineno-18-179" href="#__codelineno-18-179"></a><span class="w">        </span><span class="n">query_string_blocks</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">query_string</span><span class="p">;</span>
<a id="__codelineno-18-180" name="__codelineno-18-180" href="#__codelineno-18-180"></a><span class="w">        </span><span class="n">reference_string_blocks</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">reference_string</span><span class="p">;</span>
<a id="__codelineno-18-181" name="__codelineno-18-181" href="#__codelineno-18-181"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-18-182" name="__codelineno-18-182" href="#__codelineno-18-182"></a><span class="w">    </span><span class="n">tbr_t</span><span class="w"> </span><span class="n">tb_streams_host</span><span class="p">[</span><span class="n">N_BLOCKS</span><span class="p">][</span><span class="n">MAX_REFERENCE_LENGTH</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">MAX_QUERY_LENGTH</span><span class="p">];</span>
<a id="__codelineno-18-183" name="__codelineno-18-183" href="#__codelineno-18-183"></a><span class="w">    </span><span class="n">HostUtils</span><span class="o">::</span><span class="n">IO</span><span class="o">::</span><span class="n">SwitchDimension</span><span class="p">(</span><span class="n">tb_streams</span><span class="p">,</span><span class="w"> </span><span class="n">tb_streams_host</span><span class="p">);</span>
<a id="__codelineno-18-184" name="__codelineno-18-184" href="#__codelineno-18-184"></a><span class="w">    </span><span class="n">kernel_alignments</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">HostUtils</span><span class="o">::</span><span class="n">Sequence</span><span class="o">::</span><span class="n">ReconstructTracebackBlocks</span><span class="o">&lt;</span><span class="n">tbr_t</span><span class="p">,</span><span class="w"> </span><span class="n">N_BLOCKS</span><span class="p">,</span><span class="w"> </span><span class="n">MAX_QUERY_LENGTH</span><span class="p">,</span><span class="w"> </span><span class="n">MAX_REFERENCE_LENGTH</span><span class="o">&gt;</span><span class="p">(</span>
<a id="__codelineno-18-185" name="__codelineno-18-185" href="#__codelineno-18-185"></a><span class="w">        </span><span class="n">query_string_blocks</span><span class="p">,</span><span class="w"> </span><span class="n">reference_string_blocks</span><span class="p">,</span>
<a id="__codelineno-18-186" name="__codelineno-18-186" href="#__codelineno-18-186"></a><span class="w">        </span><span class="n">tb_query_lengths</span><span class="p">,</span><span class="w"> </span><span class="n">tb_reference_lengths</span><span class="p">,</span><span class="w"> </span>
<a id="__codelineno-18-187" name="__codelineno-18-187" href="#__codelineno-18-187"></a><span class="w">        </span><span class="n">tb_streams_host</span><span class="p">);</span>
<a id="__codelineno-18-188" name="__codelineno-18-188" href="#__codelineno-18-188"></a>
<a id="__codelineno-18-189" name="__codelineno-18-189" href="#__codelineno-18-189"></a><span class="w">    </span><span class="c1">// Print kernel 0 traceback</span>
<a id="__codelineno-18-190" name="__codelineno-18-190" href="#__codelineno-18-190"></a><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">N_BLOCKS</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-18-191" name="__codelineno-18-191" href="#__codelineno-18-191"></a><span class="w">        </span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;Kernel &quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot; Traceback&quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">endl</span><span class="p">;</span>
<a id="__codelineno-18-192" name="__codelineno-18-192" href="#__codelineno-18-192"></a><span class="w">        </span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;Kernel   Aligned Query    : &quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">kernel_alignments</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s">&quot;query&quot;</span><span class="p">]</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">endl</span><span class="p">;</span>
<a id="__codelineno-18-193" name="__codelineno-18-193" href="#__codelineno-18-193"></a><span class="w">        </span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;Kernel   Aligned Reference: &quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">kernel_alignments</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s">&quot;reference&quot;</span><span class="p">]</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">endl</span><span class="p">;</span>
<a id="__codelineno-18-194" name="__codelineno-18-194" href="#__codelineno-18-194"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-18-195" name="__codelineno-18-195" href="#__codelineno-18-195"></a><span class="p">}</span>
</code></pre></div>

</div>

<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This testbench is for the purpose of C simulation only and is different from the OpenCL based Host program mentioned later which is needed for the actual deployment of the kernel on FPGA.</p>
</div>
<h3 id="step-3-build-and-run">Step 3: Build and Run</h3>
<p>Once dependencies are installed, you need to edit the <code>CMakeLists.txt</code> provided in the GitHub repository for your own kernel target. </p>
<p>For each target, you need to add the lines specifying the following:</p>
<ol>
<li>Common source file - <code>COMMON_SRCS</code> that is required for all the kernels. </li>
<li>Testbench file. </li>
<li>User defined function source. </li>
</ol>
<p>Then you need to add the folder containing <code>params.h</code> as a include path for your kernel. The following example shows how it should be done for global affine kernel. These lines need to be added in the <code>CMakeLists.txt</code>. Similarly, you need to do it for your own custom kernel. </p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-19-1" name="__codelineno-19-1" href="#__codelineno-19-1"></a><span class="nb">add_executable</span><span class="p">(</span><span class="s">test_csim_global_affine</span>
<a id="__codelineno-19-2" name="__codelineno-19-2" href="#__codelineno-19-2"></a><span class="w">    </span><span class="s2">&quot;testbench/test_csim_global_affine.cpp&quot;</span>
<a id="__codelineno-19-3" name="__codelineno-19-3" href="#__codelineno-19-3"></a><span class="w">    </span><span class="s2">&quot;kernels/global_affine/kernel_global_affine.cpp&quot;</span>
<a id="__codelineno-19-4" name="__codelineno-19-4" href="#__codelineno-19-4"></a><span class="w">    </span><span class="o">${</span><span class="nv">COMMON_SRCS</span><span class="o">}</span><span class="p">)</span>
<a id="__codelineno-19-5" name="__codelineno-19-5" href="#__codelineno-19-5"></a>
<a id="__codelineno-19-6" name="__codelineno-19-6" href="#__codelineno-19-6"></a><span class="nb">target_include_directories</span><span class="p">(</span><span class="s">test_csim_global_affine</span><span class="w"> </span><span class="s">PRIVATE</span><span class="w"> </span><span class="s2">&quot;./kernels/global_affine&quot;</span><span class="p">)</span>
</code></pre></div>
<p>Once the <code>CMakeLists.txt</code> is configured, follow the below commands to build and run the target (i.e, your own custom kernel).</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-20-1" name="__codelineno-20-1" href="#__codelineno-20-1"></a>mkdir<span class="w"> </span>build<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nb">cd</span><span class="w"> </span>build
<a id="__codelineno-20-2" name="__codelineno-20-2" href="#__codelineno-20-2"></a>cmake<span class="w"> </span>..
<a id="__codelineno-20-3" name="__codelineno-20-3" href="#__codelineno-20-3"></a>make<span class="w"> </span>&lt;target&gt;<span class="w"> </span><span class="c1">## here the target is the kernel found in the CMakeLists.txt</span>
</code></pre></div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>With the CMake extension, VSCode automatically detect and configure the CMake project with the <code>CMakeLists.txt</code> provided in the repo. You can simply use the VSCode CMake extension GUI to build and run the project. </p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Kernels in DP-HLS framework are tested on CentOS7 with AMD Vitis 2021.2, the OS and toolchain which comes with the AWS FPGA Developer AMI. We would suggest this platform to build and run the DP-HLS kernels because it comes with the device license in AMD Vitis and Vivado for the FPGA device on AWS F1 instances. </p>
<p>If you are not using the specified AMI, then you need to set the <code>HLS_HOME</code> variable in <code>CMakeLists.txt</code> to point to the customized Vitis HLS installation path so CMake can find the correct include and link path. </p>
</div>
<h2 id="synthesize-and-deploy-new-kernels">Synthesize and deploy new kernels</h2>
<h3 id="step-1-write-host-side-program">Step 1: Write host-side program</h3>
<p>In addition to the <code>params.h</code> and your kernel function source file, you need to write a OpenCL host program to synthesize and deploy the kernel. A simple example for the host program can be found in the <a href="https://github.com/Xilinx/Vitis_Accel_Examples/blob/f61637e9263ecc1be3df34182ea6c53a0ca10447/hello_world/src/host.cpp">Vitis Examples</a>.</p>
<p>The following code shows a sample host program for your reference.</p>
<style>
.scrollable-code {
    max-height: 300px; /* Adjust the height as needed */
    overflow-y: auto;
}
</style>

<div class="scrollable-code">

<div class="highlight"><pre><span></span><code><a id="__codelineno-21-1" name="__codelineno-21-1" href="#__codelineno-21-1"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;xcl2.hpp&quot;</span>
<a id="__codelineno-21-2" name="__codelineno-21-2" href="#__codelineno-21-2"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;vector&gt;</span>
<a id="__codelineno-21-3" name="__codelineno-21-3" href="#__codelineno-21-3"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;algorithm&gt;</span>
<a id="__codelineno-21-4" name="__codelineno-21-4" href="#__codelineno-21-4"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;ap_int.h&gt;</span>
<a id="__codelineno-21-5" name="__codelineno-21-5" href="#__codelineno-21-5"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;ap_fixed.h&gt;</span>
<a id="__codelineno-21-6" name="__codelineno-21-6" href="#__codelineno-21-6"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;../../include/host_utils.h&quot;</span>
<a id="__codelineno-21-7" name="__codelineno-21-7" href="#__codelineno-21-7"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;dp_hls_common.h&quot;</span>
<a id="__codelineno-21-8" name="__codelineno-21-8" href="#__codelineno-21-8"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;map&gt;</span>
<a id="__codelineno-21-9" name="__codelineno-21-9" href="#__codelineno-21-9"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;chrono&gt;</span>
<a id="__codelineno-21-10" name="__codelineno-21-10" href="#__codelineno-21-10"></a>
<a id="__codelineno-21-11" name="__codelineno-21-11" href="#__codelineno-21-11"></a><span class="kt">int</span><span class="w"> </span><span class="nf">base_to_num</span><span class="p">(</span><span class="kt">char</span><span class="w"> </span><span class="n">base</span><span class="p">){</span>
<a id="__codelineno-21-12" name="__codelineno-21-12" href="#__codelineno-21-12"></a><span class="w">    </span><span class="k">switch</span><span class="w"> </span><span class="p">(</span><span class="n">base</span><span class="p">)</span>
<a id="__codelineno-21-13" name="__codelineno-21-13" href="#__codelineno-21-13"></a><span class="w">    </span><span class="p">{</span>
<a id="__codelineno-21-14" name="__codelineno-21-14" href="#__codelineno-21-14"></a><span class="w">    </span><span class="k">case</span><span class="w"> </span><span class="sc">&#39;A&#39;</span><span class="p">:</span>
<a id="__codelineno-21-15" name="__codelineno-21-15" href="#__codelineno-21-15"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<a id="__codelineno-21-16" name="__codelineno-21-16" href="#__codelineno-21-16"></a><span class="w">    </span><span class="k">case</span><span class="w"> </span><span class="sc">&#39;C&#39;</span><span class="p">:</span>
<a id="__codelineno-21-17" name="__codelineno-21-17" href="#__codelineno-21-17"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
<a id="__codelineno-21-18" name="__codelineno-21-18" href="#__codelineno-21-18"></a><span class="w">    </span><span class="k">case</span><span class="w"> </span><span class="sc">&#39;G&#39;</span><span class="p">:</span>
<a id="__codelineno-21-19" name="__codelineno-21-19" href="#__codelineno-21-19"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="mi">2</span><span class="p">;</span>
<a id="__codelineno-21-20" name="__codelineno-21-20" href="#__codelineno-21-20"></a><span class="w">    </span><span class="k">case</span><span class="w"> </span><span class="sc">&#39;T&#39;</span><span class="p">:</span>
<a id="__codelineno-21-21" name="__codelineno-21-21" href="#__codelineno-21-21"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="mi">3</span><span class="p">;</span>
<a id="__codelineno-21-22" name="__codelineno-21-22" href="#__codelineno-21-22"></a><span class="w">    </span><span class="k">default</span><span class="o">:</span>
<a id="__codelineno-21-23" name="__codelineno-21-23" href="#__codelineno-21-23"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<a id="__codelineno-21-24" name="__codelineno-21-24" href="#__codelineno-21-24"></a><span class="cp">#ifdef CMAKEDEBUG</span>
<a id="__codelineno-21-25" name="__codelineno-21-25" href="#__codelineno-21-25"></a><span class="w">        </span><span class="k">throw</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">runtime_error</span><span class="p">(</span><span class="s">&quot;Unrecognized Nucleotide &quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">base</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">&quot; from A, C, G, and T.</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span><span class="w"> </span><span class="c1">// or throw an exception</span>
<a id="__codelineno-21-26" name="__codelineno-21-26" href="#__codelineno-21-26"></a><span class="cp">#endif</span>
<a id="__codelineno-21-27" name="__codelineno-21-27" href="#__codelineno-21-27"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-21-28" name="__codelineno-21-28" href="#__codelineno-21-28"></a><span class="p">}</span>
<a id="__codelineno-21-29" name="__codelineno-21-29" href="#__codelineno-21-29"></a>
<a id="__codelineno-21-30" name="__codelineno-21-30" href="#__codelineno-21-30"></a>
<a id="__codelineno-21-31" name="__codelineno-21-31" href="#__codelineno-21-31"></a><span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">argc</span><span class="p">,</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="o">**</span><span class="n">argv</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-21-32" name="__codelineno-21-32" href="#__codelineno-21-32"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">argc</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="mi">2</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-21-33" name="__codelineno-21-33" href="#__codelineno-21-33"></a><span class="w">        </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;Usage: &quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">argv</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot; &lt;XCLBIN File&gt;&quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
<a id="__codelineno-21-34" name="__codelineno-21-34" href="#__codelineno-21-34"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">EXIT_FAILURE</span><span class="p">;</span>
<a id="__codelineno-21-35" name="__codelineno-21-35" href="#__codelineno-21-35"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-21-36" name="__codelineno-21-36" href="#__codelineno-21-36"></a>
<a id="__codelineno-21-37" name="__codelineno-21-37" href="#__codelineno-21-37"></a><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="n">binaryFile</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span>
<a id="__codelineno-21-38" name="__codelineno-21-38" href="#__codelineno-21-38"></a><span class="w">    </span><span class="n">cl_int</span><span class="w"> </span><span class="n">err</span><span class="p">;</span>
<a id="__codelineno-21-39" name="__codelineno-21-39" href="#__codelineno-21-39"></a><span class="w">    </span><span class="n">cl</span><span class="o">::</span><span class="n">Context</span><span class="w"> </span><span class="n">context</span><span class="p">;</span>
<a id="__codelineno-21-40" name="__codelineno-21-40" href="#__codelineno-21-40"></a><span class="w">    </span><span class="n">cl</span><span class="o">::</span><span class="n">Kernel</span><span class="w"> </span><span class="n">krnl_seq_align</span><span class="p">;</span>
<a id="__codelineno-21-41" name="__codelineno-21-41" href="#__codelineno-21-41"></a><span class="w">    </span><span class="n">cl</span><span class="o">::</span><span class="n">CommandQueue</span><span class="w"> </span><span class="n">q</span><span class="p">;</span>
<a id="__codelineno-21-42" name="__codelineno-21-42" href="#__codelineno-21-42"></a>
<a id="__codelineno-21-43" name="__codelineno-21-43" href="#__codelineno-21-43"></a><span class="w">    </span><span class="c1">// Allocate memory for each array</span>
<a id="__codelineno-21-44" name="__codelineno-21-44" href="#__codelineno-21-44"></a><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">char_t</span><span class="p">,</span><span class="w"> </span><span class="n">aligned_allocator</span><span class="o">&lt;</span><span class="n">char_t</span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="n">querys</span><span class="p">(</span><span class="n">N_BLOCKS</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">MAX_QUERY_LENGTH</span><span class="p">);</span>
<a id="__codelineno-21-45" name="__codelineno-21-45" href="#__codelineno-21-45"></a><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">char_t</span><span class="p">,</span><span class="w"> </span><span class="n">aligned_allocator</span><span class="o">&lt;</span><span class="n">char_t</span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="n">references</span><span class="p">(</span><span class="n">N_BLOCKS</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">MAX_REFERENCE_LENGTH</span><span class="p">);</span>
<a id="__codelineno-21-46" name="__codelineno-21-46" href="#__codelineno-21-46"></a><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">idx_t</span><span class="p">,</span><span class="w"> </span><span class="n">aligned_allocator</span><span class="o">&lt;</span><span class="n">idx_t</span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="n">query_lengths</span><span class="p">(</span><span class="n">N_BLOCKS</span><span class="p">);</span>
<a id="__codelineno-21-47" name="__codelineno-21-47" href="#__codelineno-21-47"></a><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">idx_t</span><span class="p">,</span><span class="w"> </span><span class="n">aligned_allocator</span><span class="o">&lt;</span><span class="n">idx_t</span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="n">reference_lengths</span><span class="p">(</span><span class="n">N_BLOCKS</span><span class="p">);</span>
<a id="__codelineno-21-48" name="__codelineno-21-48" href="#__codelineno-21-48"></a><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">Penalties</span><span class="p">,</span><span class="w"> </span><span class="n">aligned_allocator</span><span class="o">&lt;</span><span class="n">Penalties</span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="n">penalties</span><span class="p">(</span><span class="n">N_BLOCKS</span><span class="p">);</span><span class="w"> </span><span class="c1">// Assuming a single penalties struct</span>
<a id="__codelineno-21-49" name="__codelineno-21-49" href="#__codelineno-21-49"></a><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">idx_t</span><span class="p">,</span><span class="w"> </span><span class="n">aligned_allocator</span><span class="o">&lt;</span><span class="n">idx_t</span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="n">traceback_start_is</span><span class="p">(</span><span class="n">N_BLOCKS</span><span class="p">);</span><span class="w">  </span><span class="c1">// Allocate buffer for the starting row and column of the buffer</span>
<a id="__codelineno-21-50" name="__codelineno-21-50" href="#__codelineno-21-50"></a><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">idx_t</span><span class="p">,</span><span class="w"> </span><span class="n">aligned_allocator</span><span class="o">&lt;</span><span class="n">idx_t</span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="n">traceback_start_js</span><span class="p">(</span><span class="n">N_BLOCKS</span><span class="p">);</span>
<a id="__codelineno-21-51" name="__codelineno-21-51" href="#__codelineno-21-51"></a><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">tbr_t</span><span class="p">,</span><span class="w"> </span><span class="n">aligned_allocator</span><span class="o">&lt;</span><span class="n">tbr_t</span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="n">tb_streams</span><span class="p">(</span><span class="n">N_BLOCKS</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="n">MAX_REFERENCE_LENGTH</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">MAX_QUERY_LENGTH</span><span class="p">));</span>
<a id="__codelineno-21-52" name="__codelineno-21-52" href="#__codelineno-21-52"></a>
<a id="__codelineno-21-53" name="__codelineno-21-53" href="#__codelineno-21-53"></a><span class="w">    </span><span class="c1">// Initialize data</span>
<a id="__codelineno-21-54" name="__codelineno-21-54" href="#__codelineno-21-54"></a><span class="w">    </span><span class="kt">char</span><span class="w"> </span><span class="n">alphabet</span><span class="p">[]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="sc">&#39;A&#39;</span><span class="p">,</span><span class="w"> </span><span class="sc">&#39;T&#39;</span><span class="p">,</span><span class="w"> </span><span class="sc">&#39;C&#39;</span><span class="p">,</span><span class="w"> </span><span class="sc">&#39;G&#39;</span><span class="p">};</span><span class="w">  </span><span class="c1">// currently putting just random sequence here</span>
<a id="__codelineno-21-55" name="__codelineno-21-55" href="#__codelineno-21-55"></a><span class="w">    </span><span class="n">string</span><span class="w"> </span><span class="n">querys_strings</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Random</span><span class="o">::</span><span class="n">Sequence</span><span class="o">&lt;</span><span class="mi">4</span><span class="o">&gt;</span><span class="p">(</span><span class="n">alphabet</span><span class="p">,</span><span class="w"> </span><span class="n">N_BLOCKS</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">MAX_QUERY_LENGTH</span><span class="p">);</span>
<a id="__codelineno-21-56" name="__codelineno-21-56" href="#__codelineno-21-56"></a><span class="w">    </span><span class="n">string</span><span class="w"> </span><span class="n">references_strings</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Random</span><span class="o">::</span><span class="n">Sequence</span><span class="o">&lt;</span><span class="mi">4</span><span class="o">&gt;</span><span class="p">(</span><span class="n">alphabet</span><span class="p">,</span><span class="w"> </span><span class="n">N_BLOCKS</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">MAX_REFERENCE_LENGTH</span><span class="p">);</span>
<a id="__codelineno-21-57" name="__codelineno-21-57" href="#__codelineno-21-57"></a><span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="n">query_ptr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">querys_strings</span><span class="p">.</span><span class="n">c_str</span><span class="p">();</span>
<a id="__codelineno-21-58" name="__codelineno-21-58" href="#__codelineno-21-58"></a><span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="n">reference_ptr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">references_strings</span><span class="p">.</span><span class="n">c_str</span><span class="p">();</span>
<a id="__codelineno-21-59" name="__codelineno-21-59" href="#__codelineno-21-59"></a><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">N_BLOCKS</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-21-60" name="__codelineno-21-60" href="#__codelineno-21-60"></a><span class="w">        </span><span class="n">query_lengths</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">MAX_QUERY_LENGTH</span><span class="p">;</span>
<a id="__codelineno-21-61" name="__codelineno-21-61" href="#__codelineno-21-61"></a><span class="w">        </span><span class="n">reference_lengths</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">MAX_REFERENCE_LENGTH</span><span class="p">;</span>
<a id="__codelineno-21-62" name="__codelineno-21-62" href="#__codelineno-21-62"></a><span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">j</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">j</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">MAX_QUERY_LENGTH</span><span class="p">;</span><span class="w"> </span><span class="n">j</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-21-63" name="__codelineno-21-63" href="#__codelineno-21-63"></a><span class="w">            </span><span class="n">querys</span><span class="p">[</span><span class="n">i</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">MAX_QUERY_LENGTH</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">j</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">type_t</span><span class="p">)</span><span class="w"> </span><span class="n">base_to_num</span><span class="p">(</span><span class="o">*</span><span class="n">query_ptr</span><span class="o">++</span><span class="p">);</span>
<a id="__codelineno-21-64" name="__codelineno-21-64" href="#__codelineno-21-64"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-21-65" name="__codelineno-21-65" href="#__codelineno-21-65"></a><span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">j</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">j</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">MAX_REFERENCE_LENGTH</span><span class="p">;</span><span class="w"> </span><span class="n">j</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-21-66" name="__codelineno-21-66" href="#__codelineno-21-66"></a><span class="w">            </span><span class="n">references</span><span class="p">[</span><span class="n">i</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">MAX_REFERENCE_LENGTH</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">j</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">type_t</span><span class="p">)</span><span class="w"> </span><span class="n">base_to_num</span><span class="p">(</span><span class="o">*</span><span class="n">reference_ptr</span><span class="o">++</span><span class="p">);</span>
<a id="__codelineno-21-67" name="__codelineno-21-67" href="#__codelineno-21-67"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-21-68" name="__codelineno-21-68" href="#__codelineno-21-68"></a><span class="w">        </span><span class="c1">// Initialize Penalties</span>
<a id="__codelineno-21-69" name="__codelineno-21-69" href="#__codelineno-21-69"></a><span class="w">        </span><span class="n">penalties</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">open</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">type_t</span><span class="p">(</span><span class="mi">-2</span><span class="p">);</span>
<a id="__codelineno-21-70" name="__codelineno-21-70" href="#__codelineno-21-70"></a><span class="w">        </span><span class="n">penalties</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">extend</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">type_t</span><span class="p">(</span><span class="mi">-1</span><span class="p">);</span>
<a id="__codelineno-21-71" name="__codelineno-21-71" href="#__codelineno-21-71"></a><span class="w">        </span><span class="n">penalties</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">mismatch</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">type_t</span><span class="p">(</span><span class="mi">-3</span><span class="p">);</span>
<a id="__codelineno-21-72" name="__codelineno-21-72" href="#__codelineno-21-72"></a><span class="w">        </span><span class="n">penalties</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">match</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">type_t</span><span class="p">(</span><span class="mi">2</span><span class="p">);</span>
<a id="__codelineno-21-73" name="__codelineno-21-73" href="#__codelineno-21-73"></a><span class="w">        </span><span class="n">penalties</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">linear_gap</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">type_t</span><span class="p">(</span><span class="mi">-1</span><span class="p">);</span>
<a id="__codelineno-21-74" name="__codelineno-21-74" href="#__codelineno-21-74"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-21-75" name="__codelineno-21-75" href="#__codelineno-21-75"></a>
<a id="__codelineno-21-76" name="__codelineno-21-76" href="#__codelineno-21-76"></a><span class="w">    </span><span class="c1">// OPENCL HOST CODE AREA START</span>
<a id="__codelineno-21-77" name="__codelineno-21-77" href="#__codelineno-21-77"></a><span class="w">    </span><span class="k">auto</span><span class="w"> </span><span class="n">devices</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">xcl</span><span class="o">::</span><span class="n">get_xil_devices</span><span class="p">();</span>
<a id="__codelineno-21-78" name="__codelineno-21-78" href="#__codelineno-21-78"></a><span class="w">    </span><span class="k">auto</span><span class="w"> </span><span class="n">fileBuf</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">xcl</span><span class="o">::</span><span class="n">read_binary_file</span><span class="p">(</span><span class="n">binaryFile</span><span class="p">);</span>
<a id="__codelineno-21-79" name="__codelineno-21-79" href="#__codelineno-21-79"></a><span class="w">    </span><span class="n">cl</span><span class="o">::</span><span class="n">Program</span><span class="o">::</span><span class="n">Binaries</span><span class="w"> </span><span class="n">bins</span><span class="p">{{</span><span class="n">fileBuf</span><span class="p">.</span><span class="n">data</span><span class="p">(),</span><span class="w"> </span><span class="n">fileBuf</span><span class="p">.</span><span class="n">size</span><span class="p">()}};</span>
<a id="__codelineno-21-80" name="__codelineno-21-80" href="#__codelineno-21-80"></a><span class="w">    </span><span class="kt">bool</span><span class="w"> </span><span class="n">valid_device</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">false</span><span class="p">;</span>
<a id="__codelineno-21-81" name="__codelineno-21-81" href="#__codelineno-21-81"></a><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">devices</span><span class="p">.</span><span class="n">size</span><span class="p">();</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-21-82" name="__codelineno-21-82" href="#__codelineno-21-82"></a><span class="w">        </span><span class="k">auto</span><span class="w"> </span><span class="n">device</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">devices</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
<a id="__codelineno-21-83" name="__codelineno-21-83" href="#__codelineno-21-83"></a><span class="w">        </span><span class="n">OCL_CHECK</span><span class="p">(</span><span class="n">err</span><span class="p">,</span><span class="w"> </span><span class="n">context</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">cl</span><span class="o">::</span><span class="n">Context</span><span class="p">(</span><span class="n">device</span><span class="p">,</span><span class="w"> </span><span class="k">nullptr</span><span class="p">,</span><span class="w"> </span><span class="k">nullptr</span><span class="p">,</span><span class="w"> </span><span class="k">nullptr</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">err</span><span class="p">));</span>
<a id="__codelineno-21-84" name="__codelineno-21-84" href="#__codelineno-21-84"></a><span class="w">        </span><span class="n">OCL_CHECK</span><span class="p">(</span><span class="n">err</span><span class="p">,</span><span class="w"> </span><span class="n">q</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">cl</span><span class="o">::</span><span class="n">CommandQueue</span><span class="p">(</span><span class="n">context</span><span class="p">,</span><span class="w"> </span><span class="n">device</span><span class="p">,</span><span class="w"> </span><span class="n">CL_QUEUE_PROFILING_ENABLE</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">err</span><span class="p">));</span>
<a id="__codelineno-21-85" name="__codelineno-21-85" href="#__codelineno-21-85"></a><span class="w">        </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;Trying to program device[&quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;]: &quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">device</span><span class="p">.</span><span class="n">getInfo</span><span class="o">&lt;</span><span class="n">CL_DEVICE_NAME</span><span class="o">&gt;</span><span class="p">()</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
<a id="__codelineno-21-86" name="__codelineno-21-86" href="#__codelineno-21-86"></a><span class="w">        </span><span class="n">cl</span><span class="o">::</span><span class="n">Program</span><span class="w"> </span><span class="n">program</span><span class="p">(</span><span class="n">context</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="n">device</span><span class="p">},</span><span class="w"> </span><span class="n">bins</span><span class="p">,</span><span class="w"> </span><span class="k">nullptr</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">err</span><span class="p">);</span>
<a id="__codelineno-21-87" name="__codelineno-21-87" href="#__codelineno-21-87"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">CL_SUCCESS</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-21-88" name="__codelineno-21-88" href="#__codelineno-21-88"></a><span class="w">            </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;Failed to program device[&quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;] with xclbin file!</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">;</span>
<a id="__codelineno-21-89" name="__codelineno-21-89" href="#__codelineno-21-89"></a><span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-21-90" name="__codelineno-21-90" href="#__codelineno-21-90"></a><span class="w">            </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;Device[&quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;]: program successful!</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">;</span>
<a id="__codelineno-21-91" name="__codelineno-21-91" href="#__codelineno-21-91"></a><span class="w">            </span><span class="n">OCL_CHECK</span><span class="p">(</span><span class="n">err</span><span class="p">,</span><span class="w"> </span><span class="n">krnl_seq_align</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">cl</span><span class="o">::</span><span class="n">Kernel</span><span class="p">(</span><span class="n">program</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;seq_align_multiple_static&quot;</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">err</span><span class="p">));</span>
<a id="__codelineno-21-92" name="__codelineno-21-92" href="#__codelineno-21-92"></a><span class="w">            </span><span class="n">valid_device</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">true</span><span class="p">;</span>
<a id="__codelineno-21-93" name="__codelineno-21-93" href="#__codelineno-21-93"></a><span class="w">            </span><span class="k">break</span><span class="p">;</span>
<a id="__codelineno-21-94" name="__codelineno-21-94" href="#__codelineno-21-94"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-21-95" name="__codelineno-21-95" href="#__codelineno-21-95"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-21-96" name="__codelineno-21-96" href="#__codelineno-21-96"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">valid_device</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-21-97" name="__codelineno-21-97" href="#__codelineno-21-97"></a><span class="w">        </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;Failed to program any device found, exit!</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">;</span>
<a id="__codelineno-21-98" name="__codelineno-21-98" href="#__codelineno-21-98"></a><span class="w">        </span><span class="n">exit</span><span class="p">(</span><span class="n">EXIT_FAILURE</span><span class="p">);</span>
<a id="__codelineno-21-99" name="__codelineno-21-99" href="#__codelineno-21-99"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-21-100" name="__codelineno-21-100" href="#__codelineno-21-100"></a>
<a id="__codelineno-21-101" name="__codelineno-21-101" href="#__codelineno-21-101"></a><span class="w">    </span><span class="c1">// Allocate Buffers in Global Memory and set kernel arguments</span>
<a id="__codelineno-21-102" name="__codelineno-21-102" href="#__codelineno-21-102"></a><span class="w">    </span><span class="n">OCL_CHECK</span><span class="p">(</span><span class="n">err</span><span class="p">,</span><span class="w"> </span><span class="n">cl</span><span class="o">::</span><span class="n">Buffer</span><span class="w"> </span><span class="n">buffer_querys</span><span class="p">(</span><span class="n">context</span><span class="p">,</span><span class="w"> </span><span class="n">CL_MEM_USE_HOST_PTR</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">CL_MEM_READ_ONLY</span><span class="p">,</span><span class="w"> </span>
<a id="__codelineno-21-103" name="__codelineno-21-103" href="#__codelineno-21-103"></a><span class="w">                                            </span><span class="k">sizeof</span><span class="p">(</span><span class="n">char_t</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">querys</span><span class="p">.</span><span class="n">size</span><span class="p">(),</span><span class="w"> </span><span class="n">querys</span><span class="p">.</span><span class="n">data</span><span class="p">(),</span><span class="w"> </span><span class="o">&amp;</span><span class="n">err</span><span class="p">));</span>
<a id="__codelineno-21-104" name="__codelineno-21-104" href="#__codelineno-21-104"></a><span class="w">    </span><span class="n">OCL_CHECK</span><span class="p">(</span><span class="n">err</span><span class="p">,</span><span class="w"> </span><span class="n">cl</span><span class="o">::</span><span class="n">Buffer</span><span class="w"> </span><span class="n">buffer_references</span><span class="p">(</span><span class="n">context</span><span class="p">,</span><span class="w"> </span><span class="n">CL_MEM_USE_HOST_PTR</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">CL_MEM_READ_ONLY</span><span class="p">,</span><span class="w"> </span>
<a id="__codelineno-21-105" name="__codelineno-21-105" href="#__codelineno-21-105"></a><span class="w">                                                </span><span class="k">sizeof</span><span class="p">(</span><span class="n">char_t</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">references</span><span class="p">.</span><span class="n">size</span><span class="p">(),</span><span class="w"> </span><span class="n">references</span><span class="p">.</span><span class="n">data</span><span class="p">(),</span><span class="w"> </span><span class="o">&amp;</span><span class="n">err</span><span class="p">));</span>
<a id="__codelineno-21-106" name="__codelineno-21-106" href="#__codelineno-21-106"></a><span class="w">    </span><span class="n">OCL_CHECK</span><span class="p">(</span><span class="n">err</span><span class="p">,</span><span class="w"> </span><span class="n">cl</span><span class="o">::</span><span class="n">Buffer</span><span class="w"> </span><span class="n">buffer_query_lengths</span><span class="p">(</span><span class="n">context</span><span class="p">,</span><span class="w"> </span><span class="n">CL_MEM_USE_HOST_PTR</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">CL_MEM_READ_ONLY</span><span class="p">,</span><span class="w"> </span>
<a id="__codelineno-21-107" name="__codelineno-21-107" href="#__codelineno-21-107"></a><span class="w">                                                   </span><span class="k">sizeof</span><span class="p">(</span><span class="n">idx_t</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">query_lengths</span><span class="p">.</span><span class="n">size</span><span class="p">(),</span><span class="w"> </span><span class="n">query_lengths</span><span class="p">.</span><span class="n">data</span><span class="p">(),</span><span class="w"> </span><span class="o">&amp;</span><span class="n">err</span><span class="p">));</span>
<a id="__codelineno-21-108" name="__codelineno-21-108" href="#__codelineno-21-108"></a><span class="w">    </span><span class="n">OCL_CHECK</span><span class="p">(</span><span class="n">err</span><span class="p">,</span><span class="w"> </span><span class="n">cl</span><span class="o">::</span><span class="n">Buffer</span><span class="w"> </span><span class="n">buffer_reference_lengths</span><span class="p">(</span><span class="n">context</span><span class="p">,</span><span class="w"> </span><span class="n">CL_MEM_USE_HOST_PTR</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">CL_MEM_READ_ONLY</span><span class="p">,</span><span class="w"> </span>
<a id="__codelineno-21-109" name="__codelineno-21-109" href="#__codelineno-21-109"></a><span class="w">                                                       </span><span class="k">sizeof</span><span class="p">(</span><span class="n">idx_t</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">reference_lengths</span><span class="p">.</span><span class="n">size</span><span class="p">(),</span><span class="w"> </span><span class="n">reference_lengths</span><span class="p">.</span><span class="n">data</span><span class="p">(),</span><span class="w"> </span><span class="o">&amp;</span><span class="n">err</span><span class="p">));</span>
<a id="__codelineno-21-110" name="__codelineno-21-110" href="#__codelineno-21-110"></a><span class="w">    </span><span class="n">OCL_CHECK</span><span class="p">(</span><span class="n">err</span><span class="p">,</span><span class="w"> </span><span class="n">cl</span><span class="o">::</span><span class="n">Buffer</span><span class="w"> </span><span class="n">buffer_penalties</span><span class="p">(</span><span class="n">context</span><span class="p">,</span><span class="w"> </span><span class="n">CL_MEM_USE_HOST_PTR</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">CL_MEM_READ_ONLY</span><span class="p">,</span><span class="w"> </span>
<a id="__codelineno-21-111" name="__codelineno-21-111" href="#__codelineno-21-111"></a><span class="w">                                               </span><span class="k">sizeof</span><span class="p">(</span><span class="n">Penalties</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">penalties</span><span class="p">.</span><span class="n">size</span><span class="p">(),</span><span class="w"> </span><span class="n">penalties</span><span class="p">.</span><span class="n">data</span><span class="p">(),</span><span class="w"> </span><span class="o">&amp;</span><span class="n">err</span><span class="p">));</span>
<a id="__codelineno-21-112" name="__codelineno-21-112" href="#__codelineno-21-112"></a><span class="w">    </span><span class="n">OCL_CHECK</span><span class="p">(</span><span class="n">err</span><span class="p">,</span><span class="w"> </span><span class="n">cl</span><span class="o">::</span><span class="n">Buffer</span><span class="w"> </span><span class="n">buffer_traceback_start_is</span><span class="p">(</span><span class="n">context</span><span class="p">,</span><span class="w"> </span><span class="n">CL_MEM_USE_HOST_PTR</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">CL_MEM_WRITE_ONLY</span><span class="p">,</span><span class="w">  </span>
<a id="__codelineno-21-113" name="__codelineno-21-113" href="#__codelineno-21-113"></a><span class="w">                                                   </span><span class="k">sizeof</span><span class="p">(</span><span class="n">idx_t</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">traceback_start_is</span><span class="p">.</span><span class="n">size</span><span class="p">(),</span><span class="w"> </span><span class="n">traceback_start_is</span><span class="p">.</span><span class="n">data</span><span class="p">(),</span><span class="w"> </span><span class="o">&amp;</span><span class="n">err</span><span class="p">));</span>
<a id="__codelineno-21-114" name="__codelineno-21-114" href="#__codelineno-21-114"></a><span class="w">    </span><span class="n">OCL_CHECK</span><span class="p">(</span><span class="n">err</span><span class="p">,</span><span class="w"> </span><span class="n">cl</span><span class="o">::</span><span class="n">Buffer</span><span class="w"> </span><span class="n">buffer_traceback_start_js</span><span class="p">(</span><span class="n">context</span><span class="p">,</span><span class="w"> </span><span class="n">CL_MEM_USE_HOST_PTR</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">CL_MEM_WRITE_ONLY</span><span class="p">,</span><span class="w"> </span>
<a id="__codelineno-21-115" name="__codelineno-21-115" href="#__codelineno-21-115"></a><span class="w">                                                       </span><span class="k">sizeof</span><span class="p">(</span><span class="n">idx_t</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">traceback_start_js</span><span class="p">.</span><span class="n">size</span><span class="p">(),</span><span class="w"> </span><span class="n">traceback_start_js</span><span class="p">.</span><span class="n">data</span><span class="p">(),</span><span class="w"> </span><span class="o">&amp;</span><span class="n">err</span><span class="p">));</span>
<a id="__codelineno-21-116" name="__codelineno-21-116" href="#__codelineno-21-116"></a><span class="w">    </span><span class="n">OCL_CHECK</span><span class="p">(</span><span class="n">err</span><span class="p">,</span><span class="w"> </span><span class="n">cl</span><span class="o">::</span><span class="n">Buffer</span><span class="w"> </span><span class="n">buffer_tb_streams</span><span class="p">(</span><span class="n">context</span><span class="p">,</span><span class="w"> </span><span class="n">CL_MEM_USE_HOST_PTR</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">CL_MEM_WRITE_ONLY</span><span class="p">,</span><span class="w"> </span>
<a id="__codelineno-21-117" name="__codelineno-21-117" href="#__codelineno-21-117"></a><span class="w">                                                </span><span class="k">sizeof</span><span class="p">(</span><span class="n">tbr_t</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">tb_streams</span><span class="p">.</span><span class="n">size</span><span class="p">(),</span><span class="w"> </span><span class="n">tb_streams</span><span class="p">.</span><span class="n">data</span><span class="p">(),</span><span class="w"> </span><span class="o">&amp;</span><span class="n">err</span><span class="p">));</span>
<a id="__codelineno-21-118" name="__codelineno-21-118" href="#__codelineno-21-118"></a>
<a id="__codelineno-21-119" name="__codelineno-21-119" href="#__codelineno-21-119"></a>
<a id="__codelineno-21-120" name="__codelineno-21-120" href="#__codelineno-21-120"></a><span class="w">    </span><span class="c1">// Set Kernel Arguments</span>
<a id="__codelineno-21-121" name="__codelineno-21-121" href="#__codelineno-21-121"></a><span class="w">    </span><span class="n">OCL_CHECK</span><span class="p">(</span><span class="n">err</span><span class="p">,</span><span class="w"> </span><span class="n">err</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">krnl_seq_align</span><span class="p">.</span><span class="n">setArg</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">buffer_querys</span><span class="p">));</span>
<a id="__codelineno-21-122" name="__codelineno-21-122" href="#__codelineno-21-122"></a><span class="w">    </span><span class="n">OCL_CHECK</span><span class="p">(</span><span class="n">err</span><span class="p">,</span><span class="w"> </span><span class="n">err</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">krnl_seq_align</span><span class="p">.</span><span class="n">setArg</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">buffer_references</span><span class="p">));</span>
<a id="__codelineno-21-123" name="__codelineno-21-123" href="#__codelineno-21-123"></a><span class="w">    </span><span class="n">OCL_CHECK</span><span class="p">(</span><span class="n">err</span><span class="p">,</span><span class="w"> </span><span class="n">err</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">krnl_seq_align</span><span class="p">.</span><span class="n">setArg</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="n">buffer_query_lengths</span><span class="p">));</span>
<a id="__codelineno-21-124" name="__codelineno-21-124" href="#__codelineno-21-124"></a><span class="w">    </span><span class="n">OCL_CHECK</span><span class="p">(</span><span class="n">err</span><span class="p">,</span><span class="w"> </span><span class="n">err</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">krnl_seq_align</span><span class="p">.</span><span class="n">setArg</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="n">buffer_reference_lengths</span><span class="p">));</span>
<a id="__codelineno-21-125" name="__codelineno-21-125" href="#__codelineno-21-125"></a><span class="w">    </span><span class="n">OCL_CHECK</span><span class="p">(</span><span class="n">err</span><span class="p">,</span><span class="w"> </span><span class="n">err</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">krnl_seq_align</span><span class="p">.</span><span class="n">setArg</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span><span class="w"> </span><span class="n">buffer_penalties</span><span class="p">));</span>
<a id="__codelineno-21-126" name="__codelineno-21-126" href="#__codelineno-21-126"></a><span class="w">    </span><span class="n">OCL_CHECK</span><span class="p">(</span><span class="n">err</span><span class="p">,</span><span class="w"> </span><span class="n">err</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">krnl_seq_align</span><span class="p">.</span><span class="n">setArg</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="w"> </span><span class="n">buffer_traceback_start_is</span><span class="p">));</span>
<a id="__codelineno-21-127" name="__codelineno-21-127" href="#__codelineno-21-127"></a><span class="w">    </span><span class="n">OCL_CHECK</span><span class="p">(</span><span class="n">err</span><span class="p">,</span><span class="w"> </span><span class="n">err</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">krnl_seq_align</span><span class="p">.</span><span class="n">setArg</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span><span class="w"> </span><span class="n">buffer_traceback_start_js</span><span class="p">));</span>
<a id="__codelineno-21-128" name="__codelineno-21-128" href="#__codelineno-21-128"></a><span class="w">    </span><span class="n">OCL_CHECK</span><span class="p">(</span><span class="n">err</span><span class="p">,</span><span class="w"> </span><span class="n">err</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">krnl_seq_align</span><span class="p">.</span><span class="n">setArg</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span><span class="w"> </span><span class="n">buffer_tb_streams</span><span class="p">));</span>
<a id="__codelineno-21-129" name="__codelineno-21-129" href="#__codelineno-21-129"></a>
<a id="__codelineno-21-130" name="__codelineno-21-130" href="#__codelineno-21-130"></a><span class="w">    </span><span class="c1">// Copy input data to device global memory</span>
<a id="__codelineno-21-131" name="__codelineno-21-131" href="#__codelineno-21-131"></a><span class="w">    </span><span class="k">auto</span><span class="w"> </span><span class="n">start</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">chrono</span><span class="o">::</span><span class="n">high_resolution_clock</span><span class="o">::</span><span class="n">now</span><span class="p">();</span>
<a id="__codelineno-21-132" name="__codelineno-21-132" href="#__codelineno-21-132"></a><span class="w">    </span><span class="n">OCL_CHECK</span><span class="p">(</span><span class="n">err</span><span class="p">,</span><span class="w"> </span><span class="n">err</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">q</span><span class="p">.</span><span class="n">enqueueMigrateMemObjects</span><span class="p">({</span><span class="n">buffer_querys</span><span class="p">,</span><span class="w"> </span><span class="n">buffer_references</span><span class="p">,</span><span class="w"> </span><span class="n">buffer_query_lengths</span><span class="p">,</span><span class="w"> </span>
<a id="__codelineno-21-133" name="__codelineno-21-133" href="#__codelineno-21-133"></a><span class="w">                                                     </span><span class="n">buffer_reference_lengths</span><span class="p">,</span><span class="w"> </span><span class="n">buffer_penalties</span><span class="p">},</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="cm">/* 0 means from host*/</span><span class="p">));</span>
<a id="__codelineno-21-134" name="__codelineno-21-134" href="#__codelineno-21-134"></a>
<a id="__codelineno-21-135" name="__codelineno-21-135" href="#__codelineno-21-135"></a><span class="w">    </span><span class="c1">// Launch the Kernel</span>
<a id="__codelineno-21-136" name="__codelineno-21-136" href="#__codelineno-21-136"></a><span class="w">    </span><span class="n">OCL_CHECK</span><span class="p">(</span><span class="n">err</span><span class="p">,</span><span class="w"> </span><span class="n">err</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">q</span><span class="p">.</span><span class="n">enqueueTask</span><span class="p">(</span><span class="n">krnl_seq_align</span><span class="p">));</span>
<a id="__codelineno-21-137" name="__codelineno-21-137" href="#__codelineno-21-137"></a>
<a id="__codelineno-21-138" name="__codelineno-21-138" href="#__codelineno-21-138"></a>
<a id="__codelineno-21-139" name="__codelineno-21-139" href="#__codelineno-21-139"></a><span class="w">    </span><span class="c1">// Copy Result from Device Global Memory to Host Local Memory</span>
<a id="__codelineno-21-140" name="__codelineno-21-140" href="#__codelineno-21-140"></a><span class="w">    </span><span class="n">OCL_CHECK</span><span class="p">(</span><span class="n">err</span><span class="p">,</span><span class="w"> </span><span class="n">err</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">q</span><span class="p">.</span><span class="n">enqueueMigrateMemObjects</span><span class="p">({</span><span class="n">buffer_traceback_start_is</span><span class="p">,</span><span class="w"> </span><span class="n">buffer_traceback_start_js</span><span class="p">,</span><span class="w"> </span><span class="n">buffer_tb_streams</span><span class="p">},</span><span class="w"> </span><span class="n">CL_MIGRATE_MEM_OBJECT_HOST</span><span class="p">));</span>
<a id="__codelineno-21-141" name="__codelineno-21-141" href="#__codelineno-21-141"></a><span class="w">    </span><span class="n">q</span><span class="p">.</span><span class="n">finish</span><span class="p">();</span>
<a id="__codelineno-21-142" name="__codelineno-21-142" href="#__codelineno-21-142"></a><span class="w">    </span><span class="k">auto</span><span class="w"> </span><span class="n">end</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">chrono</span><span class="o">::</span><span class="n">high_resolution_clock</span><span class="o">::</span><span class="n">now</span><span class="p">();</span>
<a id="__codelineno-21-143" name="__codelineno-21-143" href="#__codelineno-21-143"></a>
<a id="__codelineno-21-144" name="__codelineno-21-144" href="#__codelineno-21-144"></a><span class="w">    </span><span class="c1">// OPENCL HOST CODE AREA END</span>
<a id="__codelineno-21-145" name="__codelineno-21-145" href="#__codelineno-21-145"></a>
<a id="__codelineno-21-146" name="__codelineno-21-146" href="#__codelineno-21-146"></a><span class="w">    </span><span class="c1">// Print raw traceback pointer streams</span>
<a id="__codelineno-21-147" name="__codelineno-21-147" href="#__codelineno-21-147"></a><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">N_BLOCKS</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-21-148" name="__codelineno-21-148" href="#__codelineno-21-148"></a><span class="w">        </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;Query: &quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">querys_strings</span><span class="p">.</span><span class="n">substr</span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">MAX_QUERY_LENGTH</span><span class="p">,</span><span class="w"> </span><span class="n">MAX_QUERY_LENGTH</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
<a id="__codelineno-21-149" name="__codelineno-21-149" href="#__codelineno-21-149"></a><span class="w">        </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;Reference: &quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">references_strings</span><span class="p">.</span><span class="n">substr</span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">MAX_REFERENCE_LENGTH</span><span class="p">,</span><span class="w"> </span><span class="n">MAX_REFERENCE_LENGTH</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
<a id="__codelineno-21-150" name="__codelineno-21-150" href="#__codelineno-21-150"></a><span class="w">        </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;Traceback: &quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
<a id="__codelineno-21-151" name="__codelineno-21-151" href="#__codelineno-21-151"></a><span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">j</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">j</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">MAX_QUERY_LENGTH</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">MAX_REFERENCE_LENGTH</span><span class="p">;</span><span class="w"> </span><span class="n">j</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-21-152" name="__codelineno-21-152" href="#__codelineno-21-152"></a><span class="w">            </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">tb_streams</span><span class="p">[</span><span class="n">i</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="n">MAX_QUERY_LENGTH</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">MAX_REFERENCE_LENGTH</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">j</span><span class="p">];</span>
<a id="__codelineno-21-153" name="__codelineno-21-153" href="#__codelineno-21-153"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-21-154" name="__codelineno-21-154" href="#__codelineno-21-154"></a><span class="w">        </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
<a id="__codelineno-21-155" name="__codelineno-21-155" href="#__codelineno-21-155"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-21-156" name="__codelineno-21-156" href="#__codelineno-21-156"></a>
<a id="__codelineno-21-157" name="__codelineno-21-157" href="#__codelineno-21-157"></a><span class="w">    </span><span class="c1">// Print time</span>
<a id="__codelineno-21-158" name="__codelineno-21-158" href="#__codelineno-21-158"></a><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;Kernel execution time: &quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">chrono</span><span class="o">::</span><span class="n">duration_cast</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">chrono</span><span class="o">::</span><span class="n">milliseconds</span><span class="o">&gt;</span><span class="p">(</span><span class="n">end</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">start</span><span class="p">).</span><span class="n">count</span><span class="p">()</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;ms&quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
<a id="__codelineno-21-159" name="__codelineno-21-159" href="#__codelineno-21-159"></a>
<a id="__codelineno-21-160" name="__codelineno-21-160" href="#__codelineno-21-160"></a><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;Kernel execution complete.&quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
<a id="__codelineno-21-161" name="__codelineno-21-161" href="#__codelineno-21-161"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">EXIT_SUCCESS</span><span class="p">;</span>
<a id="__codelineno-21-162" name="__codelineno-21-162" href="#__codelineno-21-162"></a><span class="p">}</span>
</code></pre></div>

</div>

<h3 id="step-2-install-dependencies">Step 2: Install Dependencies</h3>
<p>We have provided some scripts to run the synthesis and cosimulation of the kernels. For that, you need to have <code>Python: Version &gt; 3.6</code> installed in your system. </p>
<p>Kernels in DP-HLS framework are tested on CentOS7 with AMD Vitis 2021.2, the OS and toolchain which comes with the AWS FPGA Developer AMI. 
You can use any AWS machine to synthesis the kernel as long as it's compatible with the FPGA developer AMI. We used 8-core Amazon EC2 z1d instances for the implementation of DP-HLS kernel.</p>
<h3 id="step-3-configure-the-project-using-json-file">Step 3: Configure the project using JSON file</h3>
<p>We provide a set of Python scripts with the DP-HLS repository to streamline the AMD Vitis HLS project creation, synthesis, and implementation. Those scripts are in the <code>py-hls</code> folder. </p>
<p>Those scripts require JSON configuration file as input. Following example shows how to configure the JSON file with the explanation of all parameters. This JSON file below has prefilled parameters for the global affine kernel. Similarly, you need to do it for your own custom kernel.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-22-1" name="__codelineno-22-1" href="#__codelineno-22-1"></a><span class="p">{</span>
<a id="__codelineno-22-2" name="__codelineno-22-2" href="#__codelineno-22-2"></a><span class="w">    </span><span class="nt">&quot;size&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-22-3" name="__codelineno-22-3" href="#__codelineno-22-3"></a><span class="w">        </span><span class="nt">&quot;max_problem_size&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<a id="__codelineno-22-4" name="__codelineno-22-4" href="#__codelineno-22-4"></a><span class="w">            </span><span class="p">{</span><span class="nt">&quot;max_query_length&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">256</span><span class="p">,</span><span class="w"> </span><span class="nt">&quot;max_reference_length&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">256</span><span class="p">}</span>
<a id="__codelineno-22-5" name="__codelineno-22-5" href="#__codelineno-22-5"></a><span class="w">        </span><span class="p">],</span>
<a id="__codelineno-22-6" name="__codelineno-22-6" href="#__codelineno-22-6"></a><span class="w">        </span><span class="nt">&quot;pe_num&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="mi">4</span><span class="p">,</span><span class="w"> </span><span class="mi">8</span><span class="p">,</span><span class="w"> </span><span class="mi">16</span><span class="p">,</span><span class="w"> </span><span class="mi">32</span><span class="p">],</span>
<a id="__codelineno-22-7" name="__codelineno-22-7" href="#__codelineno-22-7"></a><span class="w">        </span><span class="nt">&quot;blocks&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
<a id="__codelineno-22-8" name="__codelineno-22-8" href="#__codelineno-22-8"></a><span class="w">        </span><span class="nt">&quot;cu&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
<a id="__codelineno-22-9" name="__codelineno-22-9" href="#__codelineno-22-9"></a><span class="w">    </span><span class="p">},</span>
<a id="__codelineno-22-10" name="__codelineno-22-10" href="#__codelineno-22-10"></a><span class="w">    </span><span class="nt">&quot;kernel&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-22-11" name="__codelineno-22-11" href="#__codelineno-22-11"></a><span class="w">        </span><span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;seq_align_multiple_static&quot;</span><span class="p">,</span>
<a id="__codelineno-22-12" name="__codelineno-22-12" href="#__codelineno-22-12"></a><span class="w">        </span><span class="nt">&quot;clock_frequency&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">250000000</span>
<a id="__codelineno-22-13" name="__codelineno-22-13" href="#__codelineno-22-13"></a><span class="w">    </span><span class="p">},</span>
<a id="__codelineno-22-14" name="__codelineno-22-14" href="#__codelineno-22-14"></a><span class="w">    </span><span class="nt">&quot;design&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-22-15" name="__codelineno-22-15" href="#__codelineno-22-15"></a><span class="w">        </span><span class="nt">&quot;path_params&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;/home/centos/workspace/DP-HLS/compile_configs/global_affine/design&quot;</span><span class="p">,</span>
<a id="__codelineno-22-16" name="__codelineno-22-16" href="#__codelineno-22-16"></a><span class="w">        </span><span class="nt">&quot;path_frontend&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;/home/centos/workspace/DP-HLS/compile_configs/global_affine/design/kernel_global_affine.cpp&quot;</span><span class="p">,</span>
<a id="__codelineno-22-17" name="__codelineno-22-17" href="#__codelineno-22-17"></a><span class="w">        </span><span class="nt">&quot;dp-hls_root&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;/home/centos/workspace/DP-HLS&quot;</span><span class="p">,</span>
<a id="__codelineno-22-18" name="__codelineno-22-18" href="#__codelineno-22-18"></a><span class="w">        </span><span class="nt">&quot;host_program&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;/home/centos/workspace/DP-HLS/src/hosts/host_ocl_global.cpp&quot;</span>
<a id="__codelineno-22-19" name="__codelineno-22-19" href="#__codelineno-22-19"></a><span class="w">    </span><span class="p">},</span>
<a id="__codelineno-22-20" name="__codelineno-22-20" href="#__codelineno-22-20"></a><span class="w">    </span><span class="nt">&quot;output_path&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;/home/centos/workspace/DP-HLS/synthesis/results/global_affine&quot;</span><span class="p">,</span>
<a id="__codelineno-22-21" name="__codelineno-22-21" href="#__codelineno-22-21"></a><span class="w">    </span><span class="nt">&quot;output_name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;global_affine_inlined&quot;</span><span class="p">,</span>
<a id="__codelineno-22-22" name="__codelineno-22-22" href="#__codelineno-22-22"></a><span class="w">    </span><span class="nt">&quot;build&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-22-23" name="__codelineno-22-23" href="#__codelineno-22-23"></a><span class="w">        </span><span class="nt">&quot;build_type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;hw&quot;</span>
<a id="__codelineno-22-24" name="__codelineno-22-24" href="#__codelineno-22-24"></a><span class="w">    </span><span class="p">},</span>
<a id="__codelineno-22-25" name="__codelineno-22-25" href="#__codelineno-22-25"></a><span class="w">    </span><span class="nt">&quot;vitis_hls&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-22-26" name="__codelineno-22-26" href="#__codelineno-22-26"></a><span class="w">        </span><span class="nt">&quot;cosim_testbench&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;/home/centos/workspace/DP-HLS/testbench/test_csim_global_affine.cpp&quot;</span><span class="p">,</span>
<a id="__codelineno-22-27" name="__codelineno-22-27" href="#__codelineno-22-27"></a><span class="w">        </span><span class="nt">&quot;output_path&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;/home/centos/workspace/DP-HLS/vitis_projects/global_affine&quot;</span><span class="p">,</span>
<a id="__codelineno-22-28" name="__codelineno-22-28" href="#__codelineno-22-28"></a><span class="w">        </span><span class="nt">&quot;export_design&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span>
<a id="__codelineno-22-29" name="__codelineno-22-29" href="#__codelineno-22-29"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-22-30" name="__codelineno-22-30" href="#__codelineno-22-30"></a><span class="p">}</span>
</code></pre></div>
<h4 id="json-parameters-explained">JSON Parameters Explained</h4>
<ul>
<li><code>size</code>: Related to the size of the kernel. <ul>
<li><code>max_problem_size</code>: Defines the <code>MAX_QUERY_LENGTH</code> and <code>MAX_REFERENCE_LENGTH</code>. </li>
<li><code>pe_num</code>: Number of PE in a block (N<sub>PE</sub>). </li>
<li><code>blocks</code>: Number of blocks in a kernel (N<sub>B</sub>). </li>
<li><code>cu</code>: Number of compute units linked in a FPGA bitsteram (N<sub>K</sub>). </li>
</ul>
</li>
<li><code>kernel</code>: Related to the kernel name and clock frequency. <ul>
<li><code>name</code>: This sets the name of your custom kernel. Currently the name <code>seq_align_mulitple_static</code> is supported. </li>
<li><code>clock_frequency</code>: This sets the target clock frequency. If the design can't meet this clock frequency, then it will be lowered automatically in the kernel linking stage.</li>
</ul>
</li>
<li><code>design</code>:<ul>
<li><code>path_params</code>: Specifies the path to the folder containing the <code>params.h</code>. </li>
<li><code>path_frontend</code>: Specifies the path to the front-end kernel source file. In this case, it points to <code>kernel_global_affine.cpp</code>.</li>
<li><code>dp-hls_root</code>: Defines the root directory of the DP-HLS library. </li>
<li><code>host_program</code>: Points to the source file of the OpenCL host program that manages kernel execution on the FPGA.</li>
</ul>
</li>
<li><code>output_path</code>: Specifies the output directory for generated RTL code, reports, and log files. </li>
<li><code>output_name</code>: Defines the base name for the output files generated during the synthesis process. In this example, the output files will be prefixed with <code>global_affine_inlined</code>.</li>
<li><code>build</code>: Related to the build configuration for the Vitis project. The <code>build_type</code> can be <code>sw_emu</code>, <code>hw_emu</code>, or <code>hw</code> which is equivalent to the three <code>TARGETS</code> described in the <a href="https://github.com/aws/aws-fpga/tree/master/Vitis"><code>aws-fpga</code> repo</a>. </li>
<li><code>vitis_hls</code>: Contains settings specific to using the Vitis HLS toolchain.<ul>
<li><code>cosim_testbench</code>: Specifies the path to the C++ testbench file used for co-simulation.</li>
<li><code>output_path</code>: Indicates the output directory of the Vitis HLS project. This is separate from the bitstream output path specified in the <code>output_path</code> above. </li>
<li><code>export_design</code>: A flag indicating whether the design should be exported after synthesis. A value of <code>0</code> means the design will not be exported, while <code>1</code> would run the implementation and gives the post-route utilization number.</li>
</ul>
</li>
</ul>
<p>With the JSON config file above, you can compile a batch of kernels with the full combinations of <code>max_problem_size</code> x <code>pe_num</code> x <code>blocks</code> x <code>kernels</code> with the naming convention <code>&lt;name&gt;_&lt;max_query_length&gt;_&lt;max_reference_length&gt;_&lt;pe_num&gt;_&lt;blocks&gt;_&lt;kernels&gt;</code> in the output directory. For example, if the <code>size</code> is: 
<div class="highlight"><pre><span></span><code><a id="__codelineno-23-1" name="__codelineno-23-1" href="#__codelineno-23-1"></a><span class="nt">&quot;size&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-23-2" name="__codelineno-23-2" href="#__codelineno-23-2"></a><span class="w">    </span><span class="nt">&quot;max_problem_size&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<a id="__codelineno-23-3" name="__codelineno-23-3" href="#__codelineno-23-3"></a><span class="w">        </span><span class="p">{</span><span class="nt">&quot;max_query_length&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">256</span><span class="p">,</span><span class="w"> </span><span class="nt">&quot;max_reference_length&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">256</span><span class="p">}</span>
<a id="__codelineno-23-4" name="__codelineno-23-4" href="#__codelineno-23-4"></a><span class="w">    </span><span class="p">],</span>
<a id="__codelineno-23-5" name="__codelineno-23-5" href="#__codelineno-23-5"></a><span class="w">    </span><span class="nt">&quot;pe_num&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="mi">16</span><span class="p">,</span><span class="w"> </span><span class="mi">32</span><span class="p">],</span>
<a id="__codelineno-23-6" name="__codelineno-23-6" href="#__codelineno-23-6"></a><span class="w">    </span><span class="nt">&quot;blocks&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="mi">8</span><span class="p">,</span><span class="w"> </span><span class="mi">16</span><span class="p">],</span>
<a id="__codelineno-23-7" name="__codelineno-23-7" href="#__codelineno-23-7"></a><span class="w">    </span><span class="nt">&quot;cu&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
<a id="__codelineno-23-8" name="__codelineno-23-8" href="#__codelineno-23-8"></a><span class="p">}</span>
</code></pre></div>
Then the output director would contains the following folders, each one containing everything compile-related for that specific kernel configuration:
<div class="highlight"><pre><span></span><code><a id="__codelineno-24-1" name="__codelineno-24-1" href="#__codelineno-24-1"></a>output_dir/                      
<a id="__codelineno-24-2" name="__codelineno-24-2" href="#__codelineno-24-2"></a>├── global_affine_256_256_16_8_1
<a id="__codelineno-24-3" name="__codelineno-24-3" href="#__codelineno-24-3"></a>├── global_affine_256_256_16_16_1
<a id="__codelineno-24-4" name="__codelineno-24-4" href="#__codelineno-24-4"></a>├── global_affine_256_256_32_8_1
<a id="__codelineno-24-5" name="__codelineno-24-5" href="#__codelineno-24-5"></a>└── global_affine_256_256_32_16_1
</code></pre></div></p>
<h3 id="step-4-synthesize-the-kernel_1">Step 4: Synthesize the kernel</h3>
<p>To run the python script which streamline the AMD Vitis HLS project creation, synthesis, and implementations, run the following command:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-25-1" name="__codelineno-25-1" href="#__codelineno-25-1"></a>python<span class="w"> </span>py-hls/auto_cosim.py<span class="w"> </span>--config<span class="w"> </span>&lt;path_to_the_json_config&gt;<span class="w"> </span>--simulate<span class="w"> </span>True
</code></pre></div>
<h4 id="explaining-command-line-arguments">Explaining command-line arguments</h4>
<ul>
<li><code>--config</code>: Specify the path of the configured JSON file</li>
<li><code>--simulate</code>: Set to <code>True</code> if you need to perform the co-simulation step along with the synthesis step of the Vitis HLS design flow. Set to <code>False</code> if only synthesis step is needed to be performed.</li>
</ul>
<h3 id="step-4-analyze-the-implementation-output">Step 4: Analyze the implementation output</h3>
<p>After executing the python script which perform synthesis and co-simulation step of the Vitis HLS design flow, several output files will be created. Following shows the file structure for all the output files saved in the output directory for the global affine kernel (some non-essential files are not shown here).
<div class="highlight"><pre><span></span><code><a id="__codelineno-26-1" name="__codelineno-26-1" href="#__codelineno-26-1"></a>output_dir/                      
<a id="__codelineno-26-2" name="__codelineno-26-2" href="#__codelineno-26-2"></a>├── global_affine_256_256_16_8_1/                 
<a id="__codelineno-26-3" name="__codelineno-26-3" href="#__codelineno-26-3"></a>│   ├── _x.hw.xilinx_aws-vu9p-f1_shell-v04261818_201920_3/
<a id="__codelineno-26-4" name="__codelineno-26-4" href="#__codelineno-26-4"></a>│   ├── build_dir.hw.xilinx_aws-vu9p-f1_shell-v04261818_201920_3/
<a id="__codelineno-26-5" name="__codelineno-26-5" href="#__codelineno-26-5"></a>│   ├── report/  
<a id="__codelineno-26-6" name="__codelineno-26-6" href="#__codelineno-26-6"></a>|   ├── dp-hls-host
<a id="__codelineno-26-7" name="__codelineno-26-7" href="#__codelineno-26-7"></a>|   ├── Makefile
<a id="__codelineno-26-8" name="__codelineno-26-8" href="#__codelineno-26-8"></a>|   ├── parallel_compile_error.log         
<a id="__codelineno-26-9" name="__codelineno-26-9" href="#__codelineno-26-9"></a>│   └── parallel_compile_output.log
<a id="__codelineno-26-10" name="__codelineno-26-10" href="#__codelineno-26-10"></a>├── global_affine_256_256_16_16_1
<a id="__codelineno-26-11" name="__codelineno-26-11" href="#__codelineno-26-11"></a>├── global_affine_256_256_32_8_1
<a id="__codelineno-26-12" name="__codelineno-26-12" href="#__codelineno-26-12"></a>└── global_affine_256_256_32_16_1
</code></pre></div></p>
<h4 id="details-of-the-output-files-generated">Details of the output files generated</h4>
<ul>
<li><code>build_dir.hw.xilinx_aws-vu9p-f1_shell-v04261818_201920_3</code> contains the output <code>.xclbin</code> bitstream file, which later on needed to be used to create the AFI. </li>
<li>Detailed synthesis and implementation report (place and route) as well as the logs can be found under <code>_x.hw.xilinx_aws-vu9p-f1_shell-v04261818_201920_3</code>.<ul>
<li>Detailed Synthesis Report found in: <code>_x.hw.xilinx_aws-vu9p-f1_shell-v04261818_201920_3/seq_align_kernel/seq_align_multiple_static/seq_align_multiple_static/solution/syn/report</code></li>
<li>Synthesized Verilog source file found in: <code>_x.hw.xilinx_aws-vu9p-f1_shell-v04261818_201920_3/seq_align_kernel/seq_align_multiple_static/seq_align_multiple_static/solution/impl/verilog</code></li>
<li>Logs found in: <code>_x.hw.xilinx_aws-vu9p-f1_shell-v04261818_201920_3/logs</code></li>
</ul>
</li>
<li><code>report</code> folder contains synthesis and place and route summary. </li>
<li><code>Makefile</code> contains the the original make file used to compile the kernel. </li>
<li><code>parallel_compile_error.log</code> contains the compile error collected from the <code>stderr</code> for this specific kernel. </li>
<li><code>parallel_compile_output.log</code> contains the compile output collected from the <code>stdout</code> for this specific kernel. </li>
</ul>
<h4 id="analyze-the-output-using-gui">Analyze the output using GUI</h4>
<p>To inspect the reports of Vitis HLS Co-Simulation and Implementation visually using GUI, please open Vitis HLS GUI and select "open project" to open the folder <code>global_affine_256_256_16_8_1</code> under the path specified for <code>vitis_hls/output_path</code> in the config (different from the compile output path). Then you can find the time line trace for the cosimulation as well as the implementation (if <code>export_design=1</code> in <code>config.json</code>) resource utilization and timing. </p>
<div align="center">

<img src="images/Vitis_HLS docs timeline trace.png"/>

<figcaption>Co-Simulation Timeline Trace view in Vitis HLS GUI for Global Affine kernel (N<sub>PE</sub>=16 and N<sub>B</sub>=8)</figcaption>

</div>

<h3 id="step-5-generate-the-bitstream">Step 5: Generate the bitstream</h3>
<p>Once the kernel is synthesized and co-simulated, run the following command to generate the bitstream: 
<div class="highlight"><pre><span></span><code><a id="__codelineno-27-1" name="__codelineno-27-1" href="#__codelineno-27-1"></a>python<span class="w"> </span>py-hls/parallel_compile.py<span class="w"> </span>--config<span class="w"> </span>&lt;path_to_the_json_config&gt;<span class="w"> </span>--compile<span class="w"> </span>True<span class="w"> </span>--num_workers<span class="w"> </span>&lt;workers&gt;<span class="w"> </span>--all<span class="w"> </span>True
</code></pre></div>
The flags for this script is explained below: </p>
<ul>
<li><code>config</code>: Specify the path to the JSON configuration file mentioned above.</li>
<li><code>compile</code>: Specify whether to compile the project or not. If set to <code>False</code>, only the Makefile is created. </li>
<li><code>num_workers</code>: Specify the number of parallel compilation jobs when compiling for a batch of different kernel configs. The number depends on the available device resources. Too many parallel jobs would result in some kernel's compilation killed. </li>
<li><code>all</code>: Specify whether to compile everything for the kernel or not, including the host and the kernel. If set to <code>False</code>, then only the host is compiled. If set to <code>True</code>, then both host and kernel is compiled.</li>
</ul>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The compilation could take very long time, and you can verify the progress of the kernel compilation by inspecting the <code>v++</code> log file. Normally the compilation are put to the background, <code>tmux</code> perferrably. </p>
</div>
<h3 id="step-6-deploy-the-kernel-on-aws-f1-fpga">Step 6: Deploy the kernel on AWS F1 FPGA</h3>
<p>With the <code>.xclbin</code> bitstream file generated and the host program written (mentioned in step 1), your custom kernel is now ready to be deployed. </p>
<p>If the custom kernels' bitstream and the host program are built on another system/AWS instance other than AWS F1 FPGA instance, you can share those files with the AWS F1 instance through <a href="https://aws.amazon.com/efs/">EFS</a>. </p>
<p>Once the bitstream is available on AWS F1 FPGA instance, follow the following steps for the deployment. This standard process is also well described in the <a href="https://github.com/aws/aws-fpga/tree/master/Vitis#2-create-an-amazon-fpga-image-afi">Step 2 in Vitis Section of the AWS FPGA repo</a>. </p>
<ol>
<li>Create an F1 instance with the AWS FPGA Developer AMI. </li>
<li>Create AFI then wait until it's status is ready. </li>
<li>Run the kernel by calling the OpenCL host and pass-in the <code>.awsxclbin</code> bitstream. </li>
</ol>
<h2 id="source-code-documentation">Source Code Documentation</h2>
<p>To refer to the details of the source code for using the DP-HLS framework efficiently, please refer to <a href="doxygen/html/index.html">Source Code Documentation</a></p>
<h2 id="contributions">Contributions</h2>
<p>We welcome contributions from the community. If you encounter any issues or have suggestions for improvement, please open an issue on GitHub. For general inquiries and support, reach out to our team.</p>
<h2 id="citing-dp-hls">Citing DP-HLS</h2>
<p>If you use DP-HLS in your research or publications, please cite the following paper:</p>
<p>Y. Cao, A. Gupta, J. Liang, and Y. Turakhia, “DP-HLS: A high-level synthesis framework for accelerating dynamic programming algorithms in bioinformatics,” 2024. [Online]. Available: https://arxiv.org/abs/2411.03398</p>












                
              </article>
            </div>
          
          
  <script>var tabs=__md_get("__tabs");if(Array.isArray(tabs))e:for(var set of document.querySelectorAll(".tabbed-set")){var labels=set.querySelector(".tabbed-labels");for(var tab of tabs)for(var label of labels.getElementsByTagName("label"))if(label.innerText.trim()===tab){var input=document.getElementById(label.htmlFor);input.checked=!0;continue e}}</script>

<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg>
  Back to top
</button>
        
      </main>
      
        <footer class="md-footer">
  
    
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
        <div class="md-social">
  
    
    
    
    
      
      
    
    <a href="https://github.com/TurakhiaLab" target="_blank" rel="noopener" title="github.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 480 512"><!--! Font Awesome Free 6.7.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M186.1 328.7c0 20.9-10.9 55.1-36.7 55.1s-36.7-34.2-36.7-55.1 10.9-55.1 36.7-55.1 36.7 34.2 36.7 55.1M480 278.2c0 31.9-3.2 65.7-17.5 95-37.9 76.6-142.1 74.8-216.7 74.8-75.8 0-186.2 2.7-225.6-74.8-14.6-29-20.2-63.1-20.2-95 0-41.9 13.9-81.5 41.5-113.6-5.2-15.8-7.7-32.4-7.7-48.8 0-21.5 4.9-32.3 14.6-51.8 45.3 0 74.3 9 108.8 36 29-6.9 58.8-10 88.7-10 27 0 54.2 2.9 80.4 9.2 34-26.7 63-35.2 107.8-35.2 9.8 19.5 14.6 30.3 14.6 51.8 0 16.4-2.6 32.7-7.7 48.2 27.5 32.4 39 72.3 39 114.2m-64.3 50.5c0-43.9-26.7-82.6-73.5-82.6-18.9 0-37 3.4-56 6-14.9 2.3-29.8 3.2-45.1 3.2-15.2 0-30.1-.9-45.1-3.2-18.7-2.6-37-6-56-6-46.8 0-73.5 38.7-73.5 82.6 0 87.8 80.4 101.3 150.4 101.3h48.2c70.3 0 150.6-13.4 150.6-101.3m-82.6-55.1c-25.8 0-36.7 34.2-36.7 55.1s10.9 55.1 36.7 55.1 36.7-34.2 36.7-55.1-10.9-55.1-36.7-55.1"/></svg>
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": ".", "features": ["navigation.tabs", "navigation.sections", "navigation.path", "navigation.tabs.sticky", "navigation.instant.prefetch", "navigation.tracking", "navigation.footer", "navigation.expand", "toc.integrate", "navigation.top", "search.suggest", "search.highlight", "content.tabs.link", "content.code.annotation", "content.code.copy", "content.action.edit", "content.action.view", "content.tooltips", "toc.follow"], "search": "assets/javascripts/workers/search.6ce7567c.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="assets/javascripts/bundle.88dd0f4e.min.js"></script>
      
    
  </body>
</html>